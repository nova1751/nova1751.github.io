<!DOCTYPE html><html lang="zh-CN" data-theme="default"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Vue3笔记 | 希亚的西红柿のBlog</title><meta name="author" content="希亚的西红柿"><meta name="copyright" content="希亚的西红柿"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文主要记录了关于 Vue3 的相关笔记，主要记录 Vue3 及其生态的使用与技巧，不定时更新。  基础创建一个 app 实例并挂载1234567891011import { createApp } from &quot;vue&quot;; &#x2F;&#x2F; 从一个单文件组件中导入根组件 import App from &quot;.&#x2F;App.vue&quot;;  const app &#x3D; createAp">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3笔记">
<meta property="og:url" content="http://blog.refrain.site/posts/3c94855e/index.html">
<meta property="og:site_name" content="希亚的西红柿のBlog">
<meta property="og:description" content="本文主要记录了关于 Vue3 的相关笔记，主要记录 Vue3 及其生态的使用与技巧，不定时更新。  基础创建一个 app 实例并挂载1234567891011import { createApp } from &quot;vue&quot;; &#x2F;&#x2F; 从一个单文件组件中导入根组件 import App from &quot;.&#x2F;App.vue&quot;;  const app &#x3D; createAp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/11/25/Tec3u9LNntZhsx6.png">
<meta property="article:published_time" content="2023-11-25T09:57:47.000Z">
<meta property="article:modified_time" content="2023-12-31T14:10:53.000Z">
<meta property="article:author" content="希亚的西红柿">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="Front End">
<meta property="article:tag" content="Framework">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/11/25/Tec3u9LNntZhsx6.png"><link rel="shortcut icon" href="/"><link rel="canonical" href="http://blog.refrain.site/posts/3c94855e/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/pwa/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/pwa/images/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/pwa/images/16.png"/><link rel="mask-icon" href="/pwa/images/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nova1751/sources/scripts/index.css"><link rel="stylesheet" href="https://npm.elemecdn.com/@fortawesome/fontawesome-free@latest/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/@fancyapps/ui@latest/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://npm.elemecdn.com/flickr-justified-gallery@latest/dist/fjGallery.min.js',
      css: 'https://npm.elemecdn.com/flickr-justified-gallery@latest/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Vue3笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-31 22:10:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-webfont@1.1.0/lxgwwenkai-regular.css" /><link rel="stylesheet" href="/css/custom.css" /><link rel="stylesheet" href="https://cdn.staticfile.org/prism-themes/1.9.0/prism-one-dark.min.css" /><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nova1751/hexo-shiki-plugin@latest/lib/codeblock.min.css">
<style>:root{--hl-color:#abb2bf;--hl-bg:#282c34;--hltools-bg:#21252b;--hltools-color:#bbbbbc;--hlnumber-bg:#282c34;--hlnumber-color:#495162;--hlscrollbar-bg:#373c47;--hlexpand-bg:linear-gradient(180deg,rgba(40,44,52,0.1),rgba(40,44,52,0.9))}</style>
    <style>
    .code-expand-btn:not(.expand-done) ~ div.codeblock,
    .code-expand-btn:not(.expand-done) ~ * div.codeblock {
      overflow: hidden;
      height: 360px;
    }
    </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock-nova1751@latest/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="希亚的西红柿のBlog" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://npm.elemecdn.com/pace-js@latest/themes/blue/pace-theme-minimal.css"/><script src="https://npm.elemecdn.com/pace-js@latest/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/nova1751-sources/blogImg/noa.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/drive/"><i class="fa-fw fas fa-cloud"></i><span> 网盘</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2023/11/25/Tec3u9LNntZhsx6.png')"><nav id="nav"><span id="blog-info"><a href="/" title="希亚的西红柿のBlog"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/nova1751-sources/blogImg/icon.png"/><span class="site-name">希亚的西红柿のBlog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/drive/"><i class="fa-fw fas fa-cloud"></i><span> 网盘</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Vue3笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-25T09:57:47.000Z" title="发表于 2023-11-25 17:57:47">2023-11-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-31T14:10:53.000Z" title="更新于 2023-12-31 22:10:53">2023-12-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Vue/">Vue</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">23k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>94分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Vue3笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div class="tip home"><p>本文主要记录了关于 Vue3 的相关笔记，主要记录 Vue3 及其生态的使用与技巧，不定时更新。</p>
</div>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="创建一个-app-实例并挂载"><a href="#创建一个-app-实例并挂载" class="headerlink" title="创建一个 app 实例并挂载"></a>创建一个 app 实例并挂载</h3><figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">createApp</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 从一个单文件组件中导入根组件</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">App</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./App.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createApp</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">App</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//</span></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">config</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">errorHandler</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">err</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/* 处理错误 */</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 挂在到跟组件 #app 容器里面</span></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;#app&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>应用根组件的内容将会被渲染在容器元素里面。容器元素自己将不会被视为应用的一部分。<br><code>.mount()</code> 方法应该始终在整个应用配置和资源注册完成后被调用。同时请注意，不同于其他资源注册方法，它的返回值是根组件实例而非应用实例。<br>这几个方法的返回值都是应用实例本身，也就是通过 <code>createApp()</code> 方法创建的对象。这样可以方便地链式调用这些方法，而不需要每次都写 <code>app.</code> 前缀。</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 创建应用实例</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createApp</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">App</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 链式调用注册方法</span></span>
<span class="line"><span style="color: #E06C75">app</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;my-button&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">MyButton</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">directive</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;focus&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">focus</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">use</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">vuex</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">mixin</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">mixin</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">provide</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;foo&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;bar&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">mount</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;#app&quot;</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 最后调用挂载方法</span></span></code></pre></div></div></figure>
</div>
<h3 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h3><ol>
<li><p>动态绑定多个值</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">objectOfAttrs</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;container&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">class</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;wrapper&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-bind</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">objectOfAttrs</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 或者 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">objectOfAttrs</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p><code>v-html</code>指令相当于将元素的<code>innerHTML</code>与之同步。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Using text interpolation: {{ </span><span style="color: #E06C75">rawHtml</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Using v-html directive: &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-html</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">rawHtml</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>调用函数</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">title</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">toTitleDate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">date</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">datetime</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">date</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  {{ </span><span style="color: #61AFEF">formatDate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">date</span><span style="color: #ABB2BF">) }}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">time</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>绑定在表达式中的方法在组件每次更新时都会被重新调用，因此<strong>不应该产生任何副作用</strong>，比如改变数据或触发异步操作。</p>
</div>
<div class="note success flat"><p>模板中的表达式将被沙盒化，仅能够访问到有限的全局对象列表。该列表中会暴露常用的内置全局对象，比如 Math 和 Date。<br>没有显式包含在列表中的全局对象将不能在模板内表达式中访问，例如用户附加在 <code>window</code> 上的属性。然而，你也可以自行在 <code>app.config.globalProperties</code> 上显式地添加它们，供所有的 <code>Vue</code> 表达式使用。</p>
</div>
</li>
<li><p>动态参数</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-on</span><span style="color: #ABB2BF">:[</span><span style="color: #D19A66">eventName</span><span style="color: #ABB2BF">]=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">doSomething</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt; ... &lt;/</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 简写 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> @[</span><span style="color: #D19A66">eventName</span><span style="color: #ABB2BF">]=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">doSomething</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="响应式基础"><a href="#响应式基础" class="headerlink" title="响应式基础"></a>响应式基础</h3><ol>
<li><p>为保证访问代理的一致性，对同一个原始对象调用 <code>reactive()</code> 会总是返回同样的代理对象，而对一个已存在的代理对象调用 <code>reactive()</code> 会返回其本身：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">raw</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {};</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">proxy</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">raw</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 代理对象和原始对象不是全等的</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">proxy</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">raw</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// false</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在同一个对象上调用 reactive() 会返回相同的代理</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">raw</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">proxy</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// true</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在一个代理上调用 reactive() 会返回它自己</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">proxy</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">proxy</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// true</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 这个规则对嵌套对象也适用。依靠深层响应性，响应式对象内的嵌套对象依然是代理：</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">proxy</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">({});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">raw</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {};</span></span>
<span class="line"><span style="color: #E5C07B">proxy</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">nested</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">raw</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">proxy</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">nested</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">raw</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// false</span></span></code></pre></div></div></figure>
</li>
<li><p><code>ref</code>对象在<code>reactive</code>对象中的解包。</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">state</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">state</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 0</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">state</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">otherCount</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">state</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">otherCount</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">state</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 2</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 原始 ref 现在已经和 state.count 失去联系</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 1</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>与 <code>reactive</code> 对象不同的是，当 <code>ref</code> 作为响应式数组或原生集合类型(如 <code>Map</code>) 中的元素被访问时，它不会被解包：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">books</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">([</span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Vue 3 Guide&quot;</span><span style="color: #ABB2BF">)]);</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 这里需要 .value</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">books</span><span style="color: #ABB2BF">[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">].</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Map</span><span style="color: #ABB2BF">([[</span><span style="color: #98C379">&quot;count&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">)]]));</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 这里需要 .value</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">map</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;count&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
</div>
</li>
<li><p>在<code>Vue3</code>中的内联事件处理器中的<code>ref</code>对象解包，与模板解包相同。</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 注意 ref 对象在模板中的解包只有顶层属性才能解包，类似下面的 count，正如上面所说，内联事件处理器中的解包规则与模板解包完全相同</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">object</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) });</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">object</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) };</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">object</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ref</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">test</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  {{ </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">count</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Add 1&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Count is: {{ </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  {{ </span><span style="color: #E5C07B">object</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF"> }} {{ </span><span style="color: #E5C07B">object</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">foo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> }}/ {{ </span><span style="color: #E5C07B">object</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<details class="folding-tag" green><summary> 查看 ref 与 reactive 简单实现 </summary>
              <div class='content'>
              <ol><li><p>基础的<code>ref</code>与<code>reactive</code>函数的定义，注意<code>ref</code>的<code>value</code>对象为<code>getter</code>和<code>setter</code>值用来适配基本的数据类型。<code>Reflect</code>的<code>receiver</code>绑定<code>get</code>或者<code>set</code>的<code>this</code>。</p><figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// ref的函数</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">val</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 此处源码中为了保持一致，在对象情况下也做了用value 访问的情况value-&gt;proxy对象</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 我们在对象情况下就不在使用value 访问</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">refObj</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">val</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//创建响应式对象</span></span>
<span class="line"><span style="color: #C678DD">class</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">refObj</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">constructor</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">val</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">_value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">val</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">get</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 在第一次执行之后触发get来收集依赖</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">track</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">_value</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">set</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">newVal</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">newVal</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">_value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">newVal</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 对象的响应式处理 在这里我们为了理解原理原理暂时不考虑对象里嵌套对象的情况</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 其实对象的响应式处理也就是重复执行reactive</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #61AFEF">isObject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Proxy</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">receiver</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// Reflect用于执行对象默认操作，更规范、函数式</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// Proxy和Object的方法Reflect都有对应</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Reflect</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">receiver</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">track</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">isObject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">receiver</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Reflect</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">receiver</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">deleteProperty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Reflect</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">deleteProperty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">  });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>追踪依赖，这部分代码比较难理解，具体思路可这样理解<br>判断当前<code>target</code>在整体<code>WeakMap</code>中是否出现，如果没出现，则设置为<code>Map</code>对象，有无<code>key</code>属性的值，则设置为<code>Set</code>对象，防止重复收集依赖，然后将依赖函数放到<code>Set</code>，对象中。</p><figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">track</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 取出最后一个数据内容</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">effect</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">effectStack</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果当前变量有依赖</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">//判断当前的map中是否有target</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">targetMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 如果没有</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// new map存储当前weakmap</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Map</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">targetMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 获取key对应的响应函数集</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 建立当前key 和依赖的关系，因为一个key 会有多个依赖</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 为了防止重复依赖，使用set</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Set</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 存入当前依赖</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">has</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>依赖收集部分</p><figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 但是还是没有响应式的能力，那么他是怎样实现响应式的呢----依赖收集，触发更新=</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 用来做依赖收集</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在源码中为为了方法的通用性，他还传入了很多参数用于兼容不同情况</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 我们意在理解原理，只需要包装fn 即可</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">fn</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 包装当前依赖函数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactiveEffect</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 模拟源码中也加入错误处理，为了避免你瞎写出现错误的情况，这就是框架的高明之处</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 给当前函数放入临时栈中，为在下面执行中，触发get，在依赖收集中能找到当前变量的依赖项来建立关系</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 执行当前函数，开始依赖收集了</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fn</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      } </span><span style="color: #C678DD">finally</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 执行成功了出栈</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pop</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>触发更新，取对象取<code>key</code>执行。</p><figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 用于触发更新</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 获取所有依赖内容</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">targetMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果有依赖的话全部拉出来执行</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 获取响应函数集合</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 执行所有响应函数</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">effect</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 源码中有异步调度任务，我们在这里省略</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      };</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">run</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure></li><li><p>完整代码</p><figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 保存临时依赖函数用于包装</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [];</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 依赖关系的map对象只能接受对象</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">targetMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">WeakMap</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 判断是不是对象</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">isObject</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">val</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">typeof</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">val</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;object&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// ref的函数</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">val</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 此处源码中为了保持一致，在对象情况下也做了用value 访问的情况value-&gt;proxy对象</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 我们在对象情况下就不在使用value 访问</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">refObj</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">val</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//创建响应式对象</span></span>
<span class="line"><span style="color: #C678DD">class</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">refObj</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">constructor</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">val</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">_value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">val</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">get</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 在第一次执行之后触发get来收集依赖</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">track</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">_value</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">set</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">value</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">newVal</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">newVal</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">_value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">newVal</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;value&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 对象的响应式处理 在这里我们为了理解原理原理暂时不考虑对象里嵌套对象的情况</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 其实对象的响应式处理也就是重复执行reactive</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #61AFEF">isObject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Proxy</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">receiver</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// Reflect用于执行对象默认操作，更规范、函数式</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// Proxy和Object的方法Reflect都有对应</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Reflect</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">receiver</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">track</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">isObject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">receiver</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Reflect</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">receiver</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">deleteProperty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Reflect</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">deleteProperty</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">res</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">  });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 到此处，当前的ref 对象就已经实现了对数据改变的监听</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">newRef</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: { </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF"> } });</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">newRef1</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 但是还是没有响应式的能力，那么他是怎样实现响应式的呢----依赖收集，触发更新=</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 用来做依赖收集</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在源码中为为了方法的通用性，他还传入了很多参数用于兼容不同情况</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 我们意在理解原理，只需要包装fn 即可</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">fn</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 包装当前依赖函数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactiveEffect</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 模拟源码中也加入错误处理，为了避免你瞎写出现错误的情况，这就是框架的高明之处</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 给当前函数放入临时栈中，为在下面执行中，触发get，在依赖收集中能找到当前变量的依赖项来建立关系</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">push</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">fn</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 执行当前函数，开始依赖收集了</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fn</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      } </span><span style="color: #C678DD">finally</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 执行成功了出栈</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">pop</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      }</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//  在收集的依赖中建立关系</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">track</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 取出最后一个数据内容</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">effect</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">effectStack</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">effectStack</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">length</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果当前变量有依赖</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">//判断当前的map中是否有target</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">targetMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 如果没有</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// new map存储当前weakmap</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Map</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">targetMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 获取key对应的响应函数集</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 建立当前key 和依赖的关系，因为一个key 会有多个依赖</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 为了防止重复依赖，使用set</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Set</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 存入当前依赖</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">has</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">effect</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 用于触发更新</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">trigger</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">target</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 获取所有依赖内容</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">targetMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果有依赖的话全部拉出来执行</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">depsMap</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 获取响应函数集合</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">depsMap</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">deps</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 执行所有响应函数</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">run</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">effect</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// 源码中有异步调度任务，我们在这里省略</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      };</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">deps</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">run</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #61AFEF">effect</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">11111</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在自己实现的effect中，由于为了演示原理，没有做兼容，不能来触发set,否则会死循环</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// vue源码中触发对effect中的做了兼容处理只会执行一次</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">newRef</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">a</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">newRef1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #E5C07B">newRef</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">a</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">b</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #E5C07B">newRef1</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure></li></ol>
              </div>
            </details>
<h3 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h3><p>计算属性是<code>vue3</code>中用于从现有数据派生衍生数据的一种<code>API</code>，它们基于<code>vue</code>实例中已有的数据，通过对这些数据进行计算得出新的值，因此我们只需要声明衍生数据的计算逻辑即可，同时计算属性会自动跟踪依赖的数据，并在相关数据发生变化时自动更新计算结果，这样，当依赖数据发生改变时，计算属性会自动重新计算，不需要手动控制何时进行计算或更新，而<code>JavaScript</code>表达式则需要我们在特定的时机通过代码执行来计算值。</p>
<p>计算属性的原理是基于<code>vue3</code>的响应式系统，它利用了<code>Proxy</code>对象和<code>Ref</code>对象来实现数据的拦截和追踪。具体来说，计算属性的实现过程可以分为以下几个步骤：</p>
<ol>
<li>创建一个计算属性<code>ref</code>，它是一个特殊的<code>ref</code>对象，它有一个<code>.value</code>属性，用于存储计算结果，以及一个<code>.effect</code>属性，用于存储计算逻辑。</li>
<li>调用<code>computed()</code>函数，传入一个<code>getter</code>函数，作为计算逻辑，返回一个计算属性<code>ref</code>。</li>
<li>在<code>getter</code>函数中，访问响应式数据，如<code>reactive</code>对象或<code>ref</code>对象，这样就会触发响应式数据的<code>get</code>拦截器，从而收集当前计算属性<code>ref</code>作为依赖，建立依赖关系。</li>
<li>在<code>getter</code>函数中，返回计算结果，将其赋值给计算属性<code>ref</code>的<code>.value</code>属性，这样就会触发计算属性<code>ref</code>的<code>set</code>拦截器，从而触发计算属性<code>ref</code>的<code>effect</code>属性，执行计算逻辑。</li>
<li>在模板或者<code>JavaScript</code>中，访问计算属性<code>ref</code>的<code>.value</code>属性，获取计算结果，同时检查计算属性<code>ref</code>的<code>dirty</code>属性，如果为<code>true</code>，说明计算属性<code>ref</code>需要重新计算，如果为<code>false</code>，说明计算属性<code>ref</code>可以直接返回缓存的结果。</li>
<li>当响应式数据发生变化时，会触发响应式数据的<code>set</code>拦截器，从而触发响应式数据的依赖列表，通知所有依赖于该数据的计算属性<code>ref</code>更新，将其<code>dirty</code>属性设为<code>true</code>，表示需要重新计算。</li>
</ol>
<p>以下是一个简单的示例，演示了计算属性的原理和用法：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 创建一个响应式对象</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">state</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 创建一个计算属性ref</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">double</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">computed</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在getter函数中，访问响应式数据</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 这样就会收集当前计算属性ref作为依赖</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;double computed&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在getter函数中，返回计算结果</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">state</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在模板或者JavaScript中，访问计算属性ref的.value属性</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 获取计算结果，同时检查计算属性ref的dirty属性</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">double</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 0</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 当响应式数据发生变化时，会触发响应式数据的依赖列表</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 通知所有依赖于该数据的计算属性ref更新，将其dirty属性设为true</span></span>
<span class="line"><span style="color: #E5C07B">state</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">count</span><span style="color: #56B6C2">++</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 再次访问计算属性ref的.value属性时，会重新计算</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">double</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 2</span></span></code></pre></div></div></figure>
<p>计算属性的优点是：</p>
<ul>
<li>可以简化模板或者 <code>JavaScript</code> 中的复杂逻辑，提高代码的可读性和可维护性。</li>
<li>可以自动缓存计算结果，提高性能和效率，避免重复计算。</li>
<li>可以自动追踪和更新依赖数据，保证数据的一致性和正确性，避免数据的过时和错误。</li>
</ul>
<p>计算属性的使用场景是：</p>
<ul>
<li>当需要从现有数据派生衍生数据时，如对数据进行格式化、过滤、排序、统计等操作。</li>
<li>当需要对数据进行复杂的计算时，如对数据进行数学、逻辑、字符串等运算。</li>
<li>当需要对数据进行条件判断时，如根据数据的值返回不同的结果或状态。</li>
</ul>
<p>计算属性默认是只读的。当你尝试修改一个计算属性时，你会收到一个运行时警告。只在某些特殊场景中你可能才需要用到“可写”的属性，你可以通过同时提供 <code>getter</code> 和 <code>setter</code> 来创建：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">computed</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">firstName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;John&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lastName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Doe&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fullName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">computed</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// getter</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">firstName</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot; &quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lastName</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// setter</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 注意：我们这里使用的是解构赋值语法</span></span>
<span class="line"><span style="color: #ABB2BF">    [</span><span style="color: #E5C07B">firstName</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">lastName</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">newValue</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot; &quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<h3 id="类与样式绑定"><a href="#类与样式绑定" class="headerlink" title="类与样式绑定"></a>类与样式绑定</h3><ol>
<li><p><code>Vue3</code>中多个<code>class</code>的绑定</p>
<blockquote>
<p>需要注意对象写法，必须以键值对的形式，不能少<br>数组写法没定义字符串的话得用字符串形式<br>组件样式和组件内模板合并</p>
</blockquote>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">activeClass</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;active&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">errorClass</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;text-danger&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;static&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  :</span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">active</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">isActive</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;text-danger&#39;</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">hasError</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">[{ </span><span style="color: #E06C75">active</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">isActive</span><span style="color: #ABB2BF"> }, </span><span style="color: #E06C75">errorClass</span><span style="color: #ABB2BF">]</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">[{ </span><span style="color: #E06C75">test1</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> }, </span><span style="color: #98C379">&#39;test2&#39;</span><span style="color: #ABB2BF">]</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 子组件模板 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;foo bar&quot;</span><span style="color: #ABB2BF">&gt;Hi!&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 在使用组件时 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;baz boo&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 结果为 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;foo bar baz boo&quot;</span><span style="color: #ABB2BF">&gt;Hi!&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- MyComponent 模板使用 $attrs 时 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E5C07B">$attrs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">class</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Hi!&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;This is a child component&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>绑定内联样式</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">activeColor</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;red&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">fontSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">30</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">styleObject</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;red&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">fontSize</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;13px&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">activeColor</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">fontSize</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">fontSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;px&#39;</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #98C379">&#39;font-size&#39;</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">fontSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;px&#39;</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">styleObject</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 还可以给 :style 绑定一个包含多个样式对象的数组。这些对象会被合并后渲染到同一元素上 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">baseStyles</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">overridingStyles</span><span style="color: #ABB2BF">]</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 你可以对一个样式属性提供多个 (不同前缀的) 值，数组仅会渲染浏览器支持的最后一个值。在这个示例中，在支持不需要特别前缀的浏览器中都会渲染为 display: flex。 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">display</span><span style="color: #ABB2BF">: [</span><span style="color: #98C379">&#39;-webkit-box&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;-ms-flexbox&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;flex&#39;</span><span style="color: #ABB2BF">] }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h3><ol>
<li><p>一个 <code>v-else</code> 元素必须跟在一个 <code>v-if</code> 或者 <code>v-else-if</code> 元素后面，否则它将不会被识别。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;A&#39;</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  A</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 和 v-else 类似，一个使用 v-else-if 的元素必须紧跟在一个 v-if 或一个 v-else-if 元素后面。 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-else-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;B&#39;</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  B</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-else-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">type</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;C&#39;</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  C</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-else</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  Not A/B/C</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p><code>template</code>上面的<code>v-if</code>。<code>v-else</code> 和 <code>v-else-if</code> 也可以在 <code>&lt;template&gt;</code> 上使用。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 一次性切换多个元素的显隐 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">ok</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">h1</span><span style="color: #ABB2BF">&gt;Title&lt;/</span><span style="color: #E06C75">h1</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Paragraph 1&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Paragraph 2&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p><code>v-show</code> 不支持在<code>&lt;template&gt;</code> 元素上使用，也不能和 <code>v-else</code> 搭配使用。</p>
</div>
</li>
<li><p><code>v-if</code>与<code>v-for</code>不应该一起使用。原因为<code>v-if</code>的优先级比<code>vue-for</code>更高，推荐的用法如下。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 使用计算属性或者与子元素作判断 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">li</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">user</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">activeUsers</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    :</span><span style="color: #D19A66">key</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  &gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    {{ </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">user</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">users</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">key</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">isActive</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      {{ </span><span style="color: #E5C07B">user</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!--</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">这会抛出一个错误，因为属性 todo 此时</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">没有在该实例上定义</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">--&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">todo</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">todos</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">todo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">isComplete</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  {{ </span><span style="color: #E5C07B">todo</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h3><ol>
<li><p><code>v-for</code>与对象</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">myObject</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;How to do lists in Vue&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">author</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;Jane Doe&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">publishedAt</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;2016-04-10&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- value:属性值，key:属性名，index：索引 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">myObject</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">{{ </span><span style="color: #E06C75">index</span><span style="color: #ABB2BF"> }}. {{ </span><span style="color: #E06C75">key</span><span style="color: #ABB2BF"> }}: {{ </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 渲染结果 --&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 0. title: How to do lists in Vue</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">     1. author: Jane Doe</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">     2. publishedAt: 2016-04-10 --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 你也可以使用 of 作为分隔符来替代 in，这更接近 JavaScript 的迭代器，二者行为基本一致 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">of</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">items</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- v-for 可以直接接受一个整数值。在这种用例中，会将该模板基于 1...n 的取值范围重复多次。注意此处 n 的初值是从 1 开始而非 0。 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h3><ol>
<li><p>关于<code>vue</code>中事件的传参，<code>@click=&quot;showInfo1&quot;</code>类似这样的默认会传过来<code>event</code>参数，可以在函数中接受，<code>showInfo1(event)&#123;&#125;</code>，注意不能加括号，这样不会传<code>event</code>参数。传多个参数的时候需要注意占位问题。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 使用特殊的 $event 变量 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">warn</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Form cannot be submitted yet.&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">$event</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">   Submit</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 使用内联箭头函数 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">event</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">warn</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Form cannot be submitted yet.&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">event</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">   Submit</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>内联事件修饰符</p>
<ul>
<li><code>.stop</code></li>
<li><code>.prevent</code></li>
<li><code>.self</code></li>
<li><code>.capture</code></li>
<li><code>.once</code></li>
<li><code>.passive</code></li>
</ul>
</li>
<li><p>按键修饰符<br>常用按键别名</p>
<ul>
<li><code>.enter</code></li>
<li><code>.tab</code></li>
<li><code>.delete</code> (捕获“Delete”和“Backspace”两个按键)</li>
<li><code>.esc</code></li>
<li><code>.space</code></li>
<li><code>.up</code></li>
<li><code>.down</code></li>
<li><code>.left</code></li>
<li><code>.right</code></li>
</ul>
<p>你可以使用以下系统按键修饰符来触发鼠标或键盘事件监听器，只有当按键被按下时才会触发。</p>
<ul>
<li><code>.ctrl</code></li>
<li><code>.alt</code></li>
<li><code>.shift</code></li>
<li><code>.meta</code></li>
</ul>
<p><code>.exact</code> 修饰符允许控制触发一个事件所需的确定组合的系统按键修饰符。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 仅在 `key` 为 `Enter` 时调用 `submit` --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">keyup</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">enter</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">submit</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">keyup</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">page-down</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onPageDown</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- Alt + Enter --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">keyup</span><span style="color: #ABB2BF">.alt.</span><span style="color: #D19A66">enter</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">clear</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- Ctrl + 点击 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">ctrl</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">doSomething</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Do something&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 当按下 Ctrl 时，即使同时按下 Alt 或 Shift 也会触发 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">ctrl</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onClick</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;A&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 仅当按下 Ctrl 且未按任何其他键时才会触发 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">.ctrl.</span><span style="color: #D19A66">exact</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onCtrlClick</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;A&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 仅当没有按下任何系统按键时触发 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">exact</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onClick</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;A&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>鼠标按键修饰符</p>
<ul>
<li><code>.left</code></li>
<li><code>.right</code></li>
<li><code>.middle</code></li>
</ul>
</li>
</ol>
<h3 id="表单输入绑定"><a href="#表单输入绑定" class="headerlink" title="表单输入绑定"></a>表单输入绑定</h3><ol>
<li><p>收集表单数据</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!--</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">我们可以使用 v-model 指令在状态和表单输入之间创建双向绑定。</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">--&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">text</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;Edit me&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">checked</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">checkedNames</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&#39;Jack&#39;</span><span style="color: #ABB2BF">])</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">picked</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;One&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">selected</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;A&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">multiSelected</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&#39;A&#39;</span><span style="color: #ABB2BF">])</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;Text Input&lt;/</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt; {{ </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;Checkbox&lt;/</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">checked</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">for</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF">&gt;Checked: {{ </span><span style="color: #E06C75">checked</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!--</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    多个复选框可以绑定到</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">    相同的 v-model 数组</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">  --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;Multi Checkbox&lt;/</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;jack&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;Jack&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">checkedNames</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">for</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;jack&quot;</span><span style="color: #ABB2BF">&gt;Jack&lt;/</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;john&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;John&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">checkedNames</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">for</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;john&quot;</span><span style="color: #ABB2BF">&gt;John&lt;/</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;mike&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;Mike&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">checkedNames</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">for</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;mike&quot;</span><span style="color: #ABB2BF">&gt;Mike&lt;/</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Checked names: &lt;</span><span style="color: #E06C75">pre</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">checkedNames</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">pre</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;Radio&lt;/</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;radio&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;one&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;One&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">picked</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">for</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;one&quot;</span><span style="color: #ABB2BF">&gt;One&lt;/</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">br</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;radio&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;two&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;Two&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">picked</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">for</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;two&quot;</span><span style="color: #ABB2BF">&gt;Two&lt;/</span><span style="color: #E06C75">label</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">br</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;Picked: {{ </span><span style="color: #E06C75">picked</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;Select&lt;/</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!-- 如果 v-model 表达式的初始值不匹配任何一个选择项，&lt;select&gt; 元素会渲染成一个“未选择”的状态。在 iOS 上，这将导致用户无法选择第一项，因为 iOS 在这种情况下不会触发一个 change 事件。因此，我们建议提供一个空值的禁用选项，如上面的例子所示。 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">selected</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">disabled</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">&gt;Please select one&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;A&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;B&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;C&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;Selected: {{ </span><span style="color: #E06C75">selected</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;Multi Select&lt;/</span><span style="color: #E06C75">h2</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">multiSelected</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">multiple</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">width:</span><span style="color: #D19A66">100</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;A&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;B&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;C&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;Selected: {{ </span><span style="color: #E06C75">multiSelected</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>复选框</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">toggle</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true-value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;yes&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false-value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;no&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">toggle</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">true-value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;yes&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">false-value</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;no&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- true-value 和 false-value 是 Vue 特有的 attributes，仅支持和 v-model 配套使用。这里 toggle 属性的值会在选中时被设为 &#39;yes&#39;，取消选择时设为 &#39;no&#39;。你同样可以通过 v-bind 将其绑定为其他动态值： --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;checkbox&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">toggle</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  :</span><span style="color: #D19A66">true-value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">dynamicTrueValue</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  :</span><span style="color: #D19A66">false-value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">dynamicFalseValue</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">/&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>选择器对象</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">selected</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 内联对象字面量 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF"> &lt;</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">number</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">123</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;123&lt;/</span><span style="color: #E06C75">option</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">select</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p><code>Vue3</code>中的生命周期选项式和组合式有一些区别。</p>
<ul>
<li><p>选项式：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/11/30/N37X9JIfkpUdyCc.png" alt=""></p>
<div class="note warning flat"><p>可以看到，在选项式<code>api</code>中，<code>setup()</code>函数的执行时机最早。</p>
</div>
</li>
<li><p>组合式</p>
<div class="note warning flat"><p>在组合式<code>api</code>中移除了<code>create</code>与<code>onBeforeCreate</code>这两个钩子，因为，其功能与<code>setup()</code>函数重复。</p>
</div>
<blockquote>
<p>其他的声明周期钩子，完整示例请参考<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cn.vuejs.org/api/composition-api-lifecycle.html#onserverprefetch">声明周期钩子索引</a>。</p>
</blockquote>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onServerPrefetch</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onMounted</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onServerPrefetch</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 组件作为初始请求的一部分被渲染</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在服务器上预抓取数据，因为它比在客户端上更快。</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetchOnServer</span><span style="color: #ABB2BF">(</span><span style="color: #7F848E; font-style: italic">/* ... */</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onMounted</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #56B6C2">!</span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 如果数据在挂载时为空值，这意味着该组件</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 是在客户端动态渲染的。将转而执行</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 另一个客户端侧的抓取请求</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetchOnClient</span><span style="color: #ABB2BF">(</span><span style="color: #7F848E; font-style: italic">/* ... */</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ul>
<h3 id="侦听器"><a href="#侦听器" class="headerlink" title="侦听器"></a>侦听器</h3><div class="note primary flat"><p>对于<code>vue3</code>中的计算属性，我们知道需要确保其只做计算而<strong>没有副作用</strong>。然而在有些情况下，我们需要在状态变化时执行一些“副作用”：例如更改 DOM，或是根据异步操作的结果去修改另一处的状态。</p>
</div>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">watch</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">question</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">answer</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Questions usually contain a question mark. ;-)&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 可以直接侦听一个 ref</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">question</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">newQuestion</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">oldQuestion</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">newQuestion</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">indexOf</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;?&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">answer</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;Thinking...&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetch</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;https://yesno.wtf/api&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">answer</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">json</span><span style="color: #ABB2BF">()).</span><span style="color: #E06C75">answer</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">answer</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;Error! Could not reach the API. &quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    Ask a yes/no question:</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">question</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">answer</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<ol>
<li><p><code>watch</code> 的第一个参数可以是不同形式的“数据源”：它可以是一个 <code>ref</code> (包括计算属性)、一个响应式对象、一个 <code>getter</code> 函数、或多个数据源组成的数组：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">y</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 单个 ref</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">newX</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`x is </span><span style="color: #C678DD">${</span><span style="color: #E06C75">newX</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// getter 函数</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">y</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">sum</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`sum of x + y is: </span><span style="color: #C678DD">${</span><span style="color: #E06C75">sum</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 多个来源组成的数组</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">([</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">y</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">], ([</span><span style="color: #E06C75; font-style: italic">newX</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">newY</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`x is </span><span style="color: #C678DD">${</span><span style="color: #E06C75">newX</span><span style="color: #C678DD">}</span><span style="color: #98C379"> and y is </span><span style="color: #C678DD">${</span><span style="color: #E06C75">newY</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
<li><p><code>watch</code>函数的疑难解析</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">//情况一：监视 ref 定义的响应式数据</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">oldValue</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sum变化了&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">oldValue</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  { </span><span style="color: #E06C75">immediate</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//情况二：监视多个 ref 定义的响应式数据 newValue: 新值的数组，按顺序排列， oldValue:  旧值的数组，按顺序排列</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">([</span><span style="color: #E06C75">sum</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">msg</span><span style="color: #ABB2BF">], (</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">oldValue</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;sum或msg变化了&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">oldValue</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* 情况三：监视 reactive 定义的响应式数据</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">      若 watch 监视的是 reactive 定义的响应式数据，则无法正确获得 oldValue！！</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">      若watch监视的是 reactive 定义的响应式数据，则强制开启了深度监视 </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">*/</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">person</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">oldValue</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;person变化了&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">oldValue</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  { </span><span style="color: #E06C75">immediate</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">deep</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">//此处的 deep 配置不再奏效</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//情况四：监视 reactive 定义的响应式数据中的某个属性</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">person</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">job</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">oldValue</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;person的job变化了&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">oldValue</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  { </span><span style="color: #E06C75">immediate</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">deep</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//情况五：监视 reactive 定义的响应式数据中的某些属性</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  [() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">person</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">job</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">person</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">oldValue</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;person的job变化了&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">oldValue</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  { </span><span style="color: #E06C75">immediate</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">deep</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//特殊情况</span></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">person</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">job</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">oldValue</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;person的job变化了&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">newValue</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">oldValue</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  { </span><span style="color: #E06C75">deep</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 此处由于监视的是 reactive 是定义的对象中的某个属性，所以 deep 配置有效</span></span></code></pre></div></div></figure>
</li>
<li><p><code>watchEffect</code>：<code>watchEffect</code>函数可以降低手动维护依赖列表的负担。</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 使用 watch</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">todoId</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">todoId</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #98C379">`https://jsonplaceholder.typicode.com/todos/</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">todoId</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span></span>
<span class="line"><span style="color: #ABB2BF">    );</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">json</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  { </span><span style="color: #E06C75">immediate</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 使用 watchEffect</span></span>
<span class="line"><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetch</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">`https://jsonplaceholder.typicode.com/todos/</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">todoId</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span></span>
<span class="line"><span style="color: #ABB2BF">  );</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">json</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p><code>watchEffect</code> 仅会在其同步执行期间，才追踪依赖。在使用异步回调时，只有在第一个 <code>await</code> 正常工作前访问到的属性才会被追踪。</p>
</div>
</li>
<li><p>回调的触发时机<br>默认情况下，用户创建的侦听器回调，都会在 <code>Vue</code> 组件更新之前被调用。这意味着你在侦听器回调中访问的 <code>DOM</code> 将是被 <code>Vue</code> 更新之前的状态。如果想在侦听器回调中能访问被 <code>Vue</code> 更新之后的 <code>DOM</code>，你需要指明 <code>flush: &#39;post&#39;</code> 选项：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">watch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">source</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">callback</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">flush</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;post&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">callback</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">flush</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;post&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 后置刷新的 watchEffect() 有个更方便的别名 watchPostEffect()：</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">watchPostEffect</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">watchPostEffect</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/* 在 Vue 更新后执行 */</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
<li><p>停止侦听器<br>在 <code>setup()</code> 或 <code>&lt;script setup&gt;</code> 中用同步语句创建的侦听器，会自动绑定到宿主组件实例上，并且会在宿主组件卸载时自动停止。因此，在大多数情况下，你无需关心怎么停止一个侦听器。<br>一个关键点是，侦听器必须用<strong>同步</strong>语句创建：如果用异步回调创建一个侦听器，那么它不会绑定到当前组件上，你必须手动停止它，以防内存泄漏。如下方这个例子：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">watchEffect</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 它会自动停止</span></span>
<span class="line"><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// ...这个则不会！</span></span>
<span class="line"><span style="color: #61AFEF">setTimeout</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {});</span></span>
<span class="line"><span style="color: #ABB2BF">}, </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>要手动停止一个侦听器，请调用 <code>watch</code> 或 <code>watchEffect</code> 返回的函数：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">unwatch</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// ...当该侦听器不再需要时</span></span>
<span class="line"><span style="color: #61AFEF">unwatch</span><span style="color: #ABB2BF">();</span></span></code></pre></div></div></figure>
<p>注意，需要异步创建侦听器的情况很少，请尽可能选择同步创建。如果需要等待一些异步数据，你可以使用条件式的侦听逻辑：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 需要异步请求得到的数据</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 一个异步的函数，用来从 API 获取数据</span></span>
<span class="line"><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetchData</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetch</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;https://some-api.com/data&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">response</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">json</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在 setup 函数中调用 fetchData 函数</span></span>
<span class="line"><span style="color: #61AFEF">fetchData</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 数据加载后执行某些操作...</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="模板引用"><a href="#模板引用" class="headerlink" title="模板引用"></a>模板引用</h3><ol>
<li><p>基本示例</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onMounted</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 声明一个 ref 来存放该元素的引用</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 必须和模板里的 ref 同名</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onMounted</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">focus</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ref</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;input&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>注意，你只可以在组件挂载后才能访问模板引用。如果你想在模板中的表达式上访问 <code>input</code>，在初次渲染时会是 <code>null</code>。这是因为在初次渲染前这个元素还不存在呢！<br>果你需要侦听一个模板引用 <code>ref</code> 的变化，确保考虑到其值为 <code>null</code> 的情况：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">input</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">focus</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">  } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 此时还未挂载，或此元素已经被卸载（例如通过 v-if 控制）</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</div>
</li>
<li><p><code>v-for</code> 中的模板引用:当在 <code>v-for</code> 中使用模板引用时，对应的 <code>ref</code> 中包含的值是一个数组，它将在元素被挂载后包含对应整个列表的所有元素(DOM 对象)：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onMounted</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">list</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">([</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/* ... */</span></span>
<span class="line"><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">itemRefs</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">([]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onMounted</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">itemRefs</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">list</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ref</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;itemRefs&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      {{ </span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">ul</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>应该注意的是，<code>ref</code> 数组并不保证与源数组相同的顺序。</p>
</div>
</li>
<li><p>函数模板引用<br>除了使用字符串值作名字，<code>ref attribute</code> 还可以绑定为一个函数，会在每次组件更新时都被调用。该函数会收到元素引用<code>DOM</code>对象或者组件实例作为其第一个参数：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- el 为绑定的 DOM 元素 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">ref</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> { </span><span style="color: #7F848E; font-style: italic">/* 将 el 赋值给一个数据属性或 ref 变量 */</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>注意我们这里需要使用动态的 <code>:ref</code>绑定才能够传入一个函数。当绑定的元素被卸载时，函数也会被调用一次，此时的 <code>el</code> 参数会是 <code>null</code>。你当然也可以绑定一个组件方法而不是内联函数。</p>
</div>
</li>
<li><p>组件上的<code>ref</code><br>模板引用也可以被用在一个子组件上。这种情况下引用中获得的值是组件实例：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onMounted</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">Child</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./Child.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">child</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onMounted</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// child.value 是 &lt;Child /&gt; 组件的实例</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">Child</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ref</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;child&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>如果一个子组件使用的是选项式 API 或没有使用 <code>&lt;script setup&gt;</code>，被引用的组件实例和该子组件的 <code>this</code> 完全一致，这意味着父组件对子组件的每一个属性和方法都有完全的访问权。这使得在父组件和子组件之间创建紧密耦合的实现细节变得很容易，当然也因此，应该只在绝对需要时才使用组件引用。大多数情况下，你应该首先使用标准的 <code>props</code> 和 <code>emit</code> 接口来实现父子组件交互。</p>
<p>有一个例外的情况，使用了 <code>&lt;script setup&gt;</code> 的组件是默认私有的：一个父组件无法访问到一个使用了 <code>&lt;script setup&gt;</code> 的子组件中的任何东西，除非子组件在其中通过 <code>defineExpose</code> 宏显式暴露：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">a</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">b</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 像 defineExpose 这样的编译器宏不需要导入</span></span>
<span class="line"><span style="color: #61AFEF">defineExpose</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>当父组件通过模板引用获取到了该组件的实例时，得到的实例类型为 <code>{ a: number, b: number }</code> (<code>ref</code> 都会自动解包，和一般的实例一样，因为拿到的<code>this</code>是一个<code>proxy</code>对象，类似<code>reactive</code>对象的解包)。</p>
</div>
</li>
</ol>
<h2 id="深入组件"><a href="#深入组件" class="headerlink" title="深入组件"></a>深入组件</h2><h3 id="组件注册"><a href="#组件注册" class="headerlink" title="组件注册"></a>组件注册</h3><div class="note primary flat"><p>一个 <code>Vue</code> 组件在使用前需要先被“注册”，这样 <code>Vue</code> 才能在渲染模板时找到其对应的实现。组件注册有两种方式：全局注册和局部注册。</p>
</div>
<ol>
<li><p>全局注册<br>基本示例：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">createApp</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createApp</span><span style="color: #ABB2BF">({});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 注册的名字</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #98C379">&quot;MyComponent&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 组件的实现</span></span>
<span class="line"><span style="color: #ABB2BF">  {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">/* ... */</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 插件形式</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ImgView</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./ImgView/index.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">Sku</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./XtxSku/index.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">componentPlugin</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">install</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">app</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// app.component(&#39;组件名字&#39;，组件配置对象)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ImgView&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">ImgView</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;XtxSku&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">Sku</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre></div></div></figure>
<p><code>.component()</code>方法可以被链式调用</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E06C75">app</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ComponentA&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">ComponentA</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ComponentB&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">ComponentB</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">  .</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;ComponentC&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">ComponentC</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
</li>
<li><p>局部注册</p>
<ul>
<li><p>组合式：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ComponentA</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./ComponentA.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">ComponentA</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>选项式</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">ComponentA</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./ComponentA.js&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">default</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">components</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">ComponentA</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// ...</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>请注意：<strong>局部注册的组件在后代组件中并不可用</strong>。在这个例子中，<code>ComponentA</code> 注册后仅在当前组件可用，而在任何的子组件或更深层的子组件中都不可用。</p>
</div>
</li>
</ul>
</li>
</ol>
<h3 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h3><p>一个组件需要显式声明它所接受的 <code>props</code>，这样 <code>Vue</code> 才能知道外部传入的哪些是 <code>props</code>，哪些是透传 <code>attribute</code>（后续详细讨论）。</p>
<ol>
<li><p>采用数组的形式声明</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;foo&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>采用对象的形式添加校验</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 使用 &lt;script setup&gt;</span></span>
<span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">likes</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Number</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure></li>
<li><p>详细的校验规则</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 基础类型检查</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// （给出 `null` 和 `undefined` 值则会跳过任何类型检查）</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">propA</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Number</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 多种可能的类型</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">propB</span><span style="color: #ABB2BF">: [</span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">Number</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 必传，且为 String 类型</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">propC</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">required</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// Number 类型的默认值</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">propD</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Number</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">default</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">100</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 对象类型的默认值</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">propE</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Object</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 对象或数组的默认值</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 必须从一个工厂函数返回。</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 该函数接收组件所接收到的原始 prop 作为参数。</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">rawProps</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;hello&quot;</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 自定义类型校验函数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">propF</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">validator</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// The value must match one of these strings</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> [</span><span style="color: #98C379">&quot;success&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;warning&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;danger&quot;</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">includes</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 函数类型的默认值</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">propG</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Function</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 不像对象或数组的默认，这不是一个</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 工厂函数。这会是一个用来作为默认值的函数</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;Default function&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p><code>defineProps()</code> 宏中的参数不可以访问 <code>&lt;script setup&gt;</code> 中定义的其他变量，因为在编译时整个表达式都会被移到外部的函数中。</p>
</div>
<p>一些补充细节：</p>
<ul>
<li><p>所有 <code>prop</code> 默认都是可选的，除非声明了<code>required: true</code>。</p>
</li>
<li><p>除 <code>Boolean</code> 外的未传递的可选 <code>prop</code> 将会有一个默认值 <code>undefined</code>。</p>
</li>
<li><p><code>Boolean</code> 类型的未传递 <code>prop</code> 将被转换为 <code>false</code>。这可以通过为它设置 <code>default</code> 来更改——例如：设置为 <code>default: undefined</code> 将与非布尔类型的 <code>prop</code> 的行为保持一致。</p>
</li>
<li><p>如果声明了 <code>default</code> 值，那么在 <code>prop</code> 的值被解析为 <code>undefined</code> 时，无论 <code>prop</code> 是未被传递还是显式指明的 <code>undefined</code>，都会改为 <code>default</code> 值。</p>
</li>
<li><p>当 <code>prop</code> 的校验失败后，<code>Vue</code> 会抛出一个控制台警告 (在开发模式下)。</p>
</li>
<li><p>如果使用了基于类型的 <code>prop</code> 声明 ，<code>Vue</code> 会尽最大努力在运行时按照 <code>prop</code> 的类型标注进行编译。举例来说，<code>defineProps&lt;&#123; msg: string &#125;&gt;</code> 会被编译为 <code>&#123; msg: &#123; type: String, required: true &#125;&#125;</code>。</p>
</li>
</ul>
<p>另外，<code>type</code> 也可以是自定义的类或构造函数，<code>Vue</code> 将会通过 <code>instanceof</code> 来检查类型是否匹配。例如下面这个类：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">class</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Person</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">constructor</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">firstName</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">lastName</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">firstName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">firstName</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">this</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">lastName</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">lastName</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<p>你可以将其作为一个 <code>prop</code> 的类型：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">author</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Person</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
<li><p><code>Boolean</code>类型转换<br>为了更贴近原生 <code>boolean attributes</code> 的行为，声明为 <code>Boolean</code> 类型的 <code>props</code> 有特别的类型转换规则。以带有如下声明的 <code>&lt;MyComponent&gt;</code> 组件为例：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 等同于传入 :disabled=&quot;true&quot; --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">MyComponent</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">disabled</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 等同于传入 :disabled=&quot;false&quot; --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">MyComponent</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
<p>当一个 <code>prop</code> 被声明为允许多种类型时，<code>Boolean</code> 的转换规则也将被应用。然而，当同时允许 <code>String</code> 和 <code>Boolean</code> 时，有一种边缘情况——只有当 <code>Boolean</code> 出现在 <code>String</code> 之前时，<code>Boolean</code> 转换规则才适用：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// disabled 将被转换为 true</span></span>
<span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">disabled</span><span style="color: #ABB2BF">: [</span><span style="color: #E06C75">Boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">Number</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// disabled 将被转换为 true</span></span>
<span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">disabled</span><span style="color: #ABB2BF">: [</span><span style="color: #E06C75">Boolean</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// disabled 将被转换为 true</span></span>
<span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">disabled</span><span style="color: #ABB2BF">: [</span><span style="color: #E06C75">Number</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">Boolean</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// disabled 将被解析为空字符串 (disabled=&quot;&quot;)</span></span>
<span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">disabled</span><span style="color: #ABB2BF">: [</span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">Boolean</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
<li><p>单向数据流</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;initialCounter&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 计数器只是将 props.initialCounter 作为初始值</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 像下面这样做就使 prop 和后续更新无关了</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">counter</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">initialCounter</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;size&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 该 prop 变更时计算属性也会自动更新</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">normalizedSize</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">computed</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">size</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">trim</span><span style="color: #ABB2BF">().</span><span style="color: #61AFEF">toLowerCase</span><span style="color: #ABB2BF">());</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="组件事件"><a href="#组件事件" class="headerlink" title="组件事件"></a>组件事件</h3><ol>
<li><p>触发与监听事件</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- MyComponent --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">$emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;someEvent&#39;</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;click me&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">some-event</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">callback</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 同样，组件的事件监听器也支持 .once 修饰符： --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">some-event</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">once</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">callback</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
<div class="note info flat"><p>像组件与 <code>prop</code> 一样，事件的名字也提供了自动的格式转换。注意这里我们触发了一个以 <code>camelCase</code> 形式命名的事件，但在父组件中可以使用 <code>kebab-case</code> 形式来监听。与 <code>prop</code> 大小写格式一样，在模板中我们也推荐使用 <code>kebab-case</code> 形式来编写监听器。</p>
</div>
</li>
<li><p>事件参数</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">increaseCount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">n</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">$emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;increaseBy&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF"> Increase by 1</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyButton</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">increase-by</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">n</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">n</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyButton</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">increase-by</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">increaseCount</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>声明触发的事件</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;inFocus&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;submit&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">buttonClick</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;submit&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 这个 emits 选项和 defineEmits() 宏还支持对象语法，它允许我们对触发事件的参数进行验证： --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">&lt;{</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;change&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">id</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;update&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}&gt;();</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>如果一个原生事件的名字 (例如 <code>click</code>) 被定义在 <code>emits</code> 选项中，则监听器只会监听组件触发的 <code>click</code> 事件而不会再响应原生的 <code>click</code> 事件。</p>
</div>
</li>
<li><p>事件校验<br>和对 <code>props</code> 添加类型校验的方式类似，所有触发的事件也可以使用对象形式来描述。<br>要为事件添加校验，那么事件可以被赋值为一个函数，接受的参数就是抛出事件时传入 <code>emit</code> 的内容，返回一个布尔值来表明事件是否合法。</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 没有校验</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">click</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">,</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 校验 submit 事件</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">submit</span><span style="color: #ABB2BF">: ({ </span><span style="color: #E06C75; font-style: italic">email</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">password</span><span style="color: #ABB2BF"> }) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">email</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">password</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">warn</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Invalid submit event payload!&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">submitForm</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">email</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">password</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;submit&quot;</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">email</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">password</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="组件-v-model"><a href="#组件-v-model" class="headerlink" title="组件 v-model"></a>组件 v-model</h3><ol>
<li><p>当使用在一个组件上时，<code>v-model</code> 会被展开为如下的形式：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">CustomInput</span></span>
<span class="line"><span style="color: #ABB2BF">  :</span><span style="color: #D19A66">model-value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">searchText</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">update</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">model-value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">newValue</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">searchText</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">newValue</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">/&gt;</span></span></code></pre></div></div></figure>
<p>要让这个例子实际工作起来，<code>&lt;CustomInput&gt;</code> 组件内部需要做两件事：</p>
<p>将内部原生 <code>&lt;input&gt;</code> 元素的 <code>value</code> attribute 绑定到 <code>modelValue</code> prop<br>当原生的 <code>input</code> 事件触发时，触发一个携带了新值的 <code>update:modelValue</code> 自定义事件</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- CustomInput.vue --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;modelValue&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;update:modelValue&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">    :</span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">modelValue</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    @</span><span style="color: #D19A66">input</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">$emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;update:modelValue&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">$event</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>另一种在组件内实现 <code>v-model</code> 的方式是使用一个可写的，同时具有 <code>getter</code> 和 <code>setter</code> 的 <code>computed</code> 属性。<code>get</code> 方法需返回 <code>modelValue</code> prop，而 <code>set</code> 方法需触发相应的事件：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- CustomInput.vue --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">computed</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;modelValue&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;update:modelValue&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">computed</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">modelValue</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;update:modelValue&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p><code>HTML</code> 中的原生表单元素的<code>v-model</code> <code>Vue</code>对其的实现与组件不同，涉及到输入开始与结束的事件，所以在<code>IME</code>的输入法中与<code>input</code>事件的行为有所不同。</p>
</div>
</li>
<li><p><code>v-model</code>的参数，给<code>props</code>和<code>emit</code>事件添加名字<br>默认情况下，<code>v-model</code> 在组件上都是使用 <code>modelValue</code> 作为 <code>prop</code>，并以 <code>update:modelValue</code> 作为对应的事件。我们可以通过给 <code>v-model</code> 指定一个参数来更改这些名字：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">UserName</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">first-name</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">first</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">last-name</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">last</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">firstName</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">lastName</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;update:firstName&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;update:lastName&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    :</span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">firstName</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    @</span><span style="color: #D19A66">input</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">$emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;update:firstName&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">$event</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    :</span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">lastName</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    @</span><span style="color: #D19A66">input</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">$emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;update:lastName&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">$event</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>处理<code>v-model</code>修饰符<br>在某些场景下，你可能想要一个自定义组件的 <code>v-model</code> 支持自定义的修饰符。我们来创建一个自定义的修饰符 <code>capitalize</code>，它会自动将 <code>v-model</code> 绑定输入的字符串值第一个字母转为大写：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">capitalize</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">myText</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
<p>组件的 <code>v-model</code> 上所添加的修饰符，可以通过 <code>modelModifiers</code> prop 在组件内访问到。在下面的组件中，我们声明了 <code>modelModifiers</code> 这个 prop，它的默认值是一个空对象：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">modelValue</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">modelModifiers</span><span style="color: #ABB2BF">: { </span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({}) },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;update:modelValue&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">modelModifiers</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// { capitalize: true }</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    :</span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">modelValue</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    @</span><span style="color: #D19A66">input</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">$emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;update:modelValue&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">$event</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>注意这里组件的 <code>modelModifiers</code> <code>prop</code> 包含了 <code>capitalize</code> 且其值为 <code>true</code>，因为它在模板中的 <code>v-model</code> 绑定 <code>v-model.capitalize=&quot;myText&quot;</code> 上被使用了。</p>
<p>有了这个 <code>prop</code>，我们就可以检查 <code>modelModifiers</code> 对象的键，并编写一个处理函数来改变抛出的值。在下面的代码里，我们就是在每次 <code>&lt;input /&gt;</code> 元素触发 <code>input</code> 事件时将值的首字母大写：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">modelValue</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">modelModifiers</span><span style="color: #ABB2BF">: { </span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({}) },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;update:modelValue&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">emitValue</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">modelModifiers</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">capitalize</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">charAt</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">toUpperCase</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">slice</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;update:modelValue&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text&quot;</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">value</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">modelValue</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">input</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">emitValue</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>带参数的 <code>v-model</code> 修饰符<br>对于又有参数又有修饰符的 <code>v-mode</code>l 绑定，生成的 <code>prop</code> 名将是 <code>arg + &quot;Modifiers&quot;</code>。举例来说：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">title</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">capitalize</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">myText</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>相应的声明应该是：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;title&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;titleModifiers&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;update:title&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">titleModifiers</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// { capitalize: true }</span></span></code></pre></div></div></figure>
<p>这里是另一个例子，展示了如何在使用多个不同参数的 <code>v-model</code> 时使用修饰符：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">UserName</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">first-name</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">capitalize</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">first</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #D19A66">v-model</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">last-name</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">uppercase</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">last</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">/&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">firstName</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">lastName</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">firstNameModifiers</span><span style="color: #ABB2BF">: { </span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({}) },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">lastNameModifiers</span><span style="color: #ABB2BF">: { </span><span style="color: #61AFEF">default</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({}) },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;update:firstName&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;update:lastName&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">firstNameModifiers</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// { capitalize: true }</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">lastNameModifiers</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// { uppercase: true}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="透传-Attributes"><a href="#透传-Attributes" class="headerlink" title="透传 Attributes"></a>透传 Attributes</h3><ol>
<li><p><code>Attributes</code> 继承<br>“透传 <code>attribute</code>”指的是传递给一个组件，却没有被该组件声明为 <code>props</code> 或 <code>emits</code> 的 <code>attribute</code> 或者 <code>v-on</code> 事件监听器。最常见的例子就是 <code>class</code>、<code>style</code> 和 <code>id</code>。</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- &lt;MyButton&gt; 的模板 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;click me&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 一个父组件使用了这个组件，并且传入了 class： --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">MyButton</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;large&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 最后渲染出的 DOM 结果是： --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;large&quot;</span><span style="color: #ABB2BF">&gt;click me&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note success flat"><p>这里，<code>&lt;MyButton&gt;</code> 并没有将 <code>class</code> 声明为一个它所接受的 <code>prop</code>，所以 <code>class</code> 被视作透传 <code>attribute</code>，自动透传到了 <code>&lt;MyButton&gt;</code> 的根元素上。</p>
</div>
</li>
<li><p>对 <code>class</code> 和 <code>style</code> 的合并</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- &lt;MyButton&gt; 的模板 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn&quot;</span><span style="color: #ABB2BF">&gt;click me&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 则最后渲染出的 DOM 结果会变成 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn large&quot;</span><span style="color: #ABB2BF">&gt;click me&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p><code>v-on</code> 监听器继承<br>同样的规则也适用于 <code>v-on</code> 事件监听器：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">MyButton</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onClick</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
<p><code>click</code> 监听器会被添加到 <code>&lt;MyButton&gt;</code> 的根元素，即那个原生的 <code>&lt;button&gt;</code> 元素之上。当原生的 <code>&lt;button&gt;</code> 被点击，会触发父组件的 <code>onClick</code> 方法。同样的，如果原生 <code>button</code> 元素自身也通过 <code>v-on</code> 绑定了一个事件监听器，则这个监听器和从父组件继承的监听器都会被触发。</p>
</li>
<li><p>深层组件继承<br>有些情况下一个组件会在根节点上渲染另一个组件。例如，我们重构一下 <code>&lt;MyButton&gt;</code>，让它在根节点上渲染 <code>&lt;BaseButton&gt;</code>：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- &lt;MyButton/&gt; 的模板，只是渲染另一个组件 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">BaseButton</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
<p>此时 <code>&lt;MyButton&gt;</code> 接收的透传 <code>attribute</code> 会直接继续传给 <code>&lt;BaseButton&gt;</code>。</p>
<p>请注意：</p>
<ol>
<li><p>透传的 <code>attribute</code> 不会包含 <code>&lt;MyButton&gt;</code> 上声明过的 <code>props</code> 或是针对 <code>emits</code> 声明事件的 <code>v-on</code> 侦听函数，换句话说，声明过的 <code>props</code> 和侦听函数被 <code>&lt;MyButton&gt;</code>“消费”了。</p>
</li>
<li><p>透传的 <code>attribute</code> 若符合声明，也可以作为 <code>props</code> 传入 <code>&lt;BaseButton&gt;</code>。</p>
</li>
</ol>
</li>
<li><p>禁用 <code>Attributes</code> 继承</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #61AFEF">defineOptions</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">inheritAttrs</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// ...setup 逻辑</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>最常见的需要禁用 <code>attribute</code> 继承的场景就是 <code>attribute</code> 需要应用在根节点以外的其他元素上。通过设置 <code>inheritAttrs</code> 选项为 <code>false</code>，你可以完全控制透传进来的 <code>attribute</code> 被如何使用。</p>
<p>这些透传进来的 <code>attribute</code> 可以在模板的表达式中直接用 <code>$attrs</code> 访问到。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;Fallthrough attribute: {{ </span><span style="color: #E06C75">$attrs</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>这个 <code>$attrs</code> 对象包含了除组件所声明的 <code>props</code> 和 <code>emits</code> 之外的所有其他 <code>attribute</code>，例如 <code>class</code>，<code>style</code>，<code>v-on</code> 监听器等等。</p>
<p>有几点需要注意：</p>
<p>和 <code>props</code> 有所不同，透传 <code>attributes</code> 在 <code>JavaScript</code> 中保留了它们原始的大小写，所以像 <code>foo-bar</code> 这样的一个 <code>attribute</code> 需要通过 <code>$attrs[&#39;foo-bar&#39;]</code> 来访问。</p>
<p>像 <code>@click</code> 这样的一个 <code>v-on</code> 事件监听器将在此对象下被暴露为一个函数 <code>$attrs.onClick</code>。</p>
<p>现在我们要再次使用一下之前小节中的 <code>&lt;MyButton&gt;</code> 组件例子。有时候我们可能为了样式，需要在 <code>&lt;button&gt;</code> 元素外包装一层 <code>&lt;div&gt;</code>：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn-wrapper&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn&quot;</span><span style="color: #ABB2BF">&gt;click me&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>我们想要所有像 <code>class</code> 和 <code>v-on</code> 监听器这样的透传 <code>attribute</code> 都应用在内部的 <code>&lt;button&gt;</code> 上而不是外层的 <code>&lt;div&gt;</code> 上。我们可以通过设定 <code>inheritAttrs: false</code> 和使用 <code>v-bind=&quot;$attrs&quot;</code> 来实现：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn-wrapper&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-bind</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">$attrs</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;click me&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>多根节点的 <code>Attributes</code> 继承<br>和单根节点组件有所不同，有着多个根节点的组件没有自动 <code>attribute</code> 透传行为。如果 <code>$attrs</code> 没有被显式绑定，将会抛出一个运行时警告。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">CustomLayout</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;custom-layout&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">changeValue</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 如果 &lt;CustomLayout&gt; 有下面这样的多根节点模板，由于 Vue 不知道要将 attribute 透传到哪里，所以会抛出一个警告。 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">header</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E06C75">header</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">main</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E06C75">main</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 如果 $attrs 被显式绑定，则不会有警告： --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">header</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E06C75">header</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">main</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-bind</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">$attrs</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E06C75">main</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>在<code>setup</code>中访问<code>Attributes</code></p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">useAttrs</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">attrs</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useAttrs</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>需要注意的是，虽然这里的 <code>attrs</code> 对象总是反映为最新的透传 <code>attribute</code>，但它并不是响应式的 (考虑到性能因素)，即不像<code>props</code>一样随着父元素的更新而更新。你不能通过侦听器去监听它的变化。如果你需要响应性，可以使用 <code>prop</code>。或者你也可以使用 <code>onUpdated()</code> 使得在每次更新时结合最新的 <code>attrs</code> 执行副作用。</p>
</div>
</li>
</ol>
<h3 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h3><ol>
<li>插槽内容可以是元素，文本甚至组件</li>
<li><p>插槽的默认内容，默认显示，但提供了插槽的内容则会取代默认内容</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;submit&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">&lt;!-- 默认内容 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    Submit</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>具名插槽</p>
<blockquote>
<p>没有提供<code>name</code> 的 <code>&lt;slot&gt;</code> 出口会隐式地命名为“default”。</p>
<p><code>v-slot</code> 有对应的简写 <code>#</code>，因此 <code>&lt;template v-slot:header&gt;</code> 可以简写为 <code>&lt;template #header&gt;</code>。其意思就是“将这部分模板片段传入子组件的 <code>header</code> 插槽中”</p>
</blockquote>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;container&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">header</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;header&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">header</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">main</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">main</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;footer&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">footer</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">BaseLayout</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-slot</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">header</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">&lt;!-- header 插槽的内容放这里 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">BaseLayout</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">BaseLayout</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">header</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">h1</span><span style="color: #ABB2BF">&gt;Here might be a page title&lt;/</span><span style="color: #E06C75">h1</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!-- 隐式的默认插槽 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;A paragraph for the main content.&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;And another one.&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">footer</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Here&#39;s some contact info&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">BaseLayout</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>动态插槽</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">base-layout</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-slot</span><span style="color: #ABB2BF">:[</span><span style="color: #D19A66">dynamicSlotName</span><span style="color: #ABB2BF">]&gt; ... &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!-- 缩写为 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #[</span><span style="color: #D19A66">dynamicSlotName</span><span style="color: #ABB2BF">]&gt; ... &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">base-layout</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>作用域插槽</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">header</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">headerProps</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt; {{ </span><span style="color: #E06C75">headerProps</span><span style="color: #ABB2BF"> }} &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">default</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">defaultProps</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt; {{ </span><span style="color: #E06C75">defaultProps</span><span style="color: #ABB2BF"> }} &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">footer</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">footerProps</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt; {{ </span><span style="color: #E06C75">footerProps</span><span style="color: #ABB2BF"> }} &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 该模板无法编译，message仅默认插槽可见 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-slot</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">footer</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">&lt;!-- message 属于默认插槽，此处不可用 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;header&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">message</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;hello&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 显示声明默认插槽作用域 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">&lt;!-- 使用显式的默认插槽 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">default</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">message</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">footer</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Here&#39;s some contact info&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><ol>
<li><p>示例</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">provide</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">provide</span><span style="color: #ABB2BF">(</span><span style="color: #7F848E; font-style: italic">/* 注入名 */</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;message&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #7F848E; font-style: italic">/* 值 */</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;hello!&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 全局注入</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">createApp</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createApp</span><span style="color: #ABB2BF">({});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">provide</span><span style="color: #ABB2BF">(</span><span style="color: #7F848E; font-style: italic">/* 注入名 */</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;message&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #7F848E; font-style: italic">/* 值 */</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;hello!&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 接收 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">inject</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">message</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">inject</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;message&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>默认值</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 如果没有祖先组件提供 &quot;message&quot;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// `value` 会是 &quot;这是默认值&quot;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">inject</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;message&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;这是默认值&quot;</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
<p>在一些场景中，默认值可能需要通过调用一个函数或初始化一个类来取得。为了避免在用不到默认值的情况下进行不必要的计算或产生副作用，我们可以使用工厂函数来创建默认值：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">inject</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;key&quot;</span><span style="color: #ABB2BF">, () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ExpensiveClass</span><span style="color: #ABB2BF">(), </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
<p>第三个参数表示默认值应该被当作一个工厂函数，即返回一个函数，按需调用。</p>
</li>
<li><p>如果你想确保提供的数据不能被注入方的组件更改，你可以使用 <code>readonly()</code> 来包装提供的值。</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">provide</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">readonly</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #61AFEF">provide</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;read-only-count&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">readonly</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">count</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p><code>provide</code>传递<code>ref</code>对象不会发生解包。</p>
</div>
</li>
</ol>
<h3 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a>异步组件</h3><ol>
<li><p>基本用法</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">defineAsyncComponent</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AsyncComp</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineAsyncComponent</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">resolve</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">reject</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// ...从服务器获取组件</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">(</span><span style="color: #7F848E; font-style: italic">/* 获取到的组件 */</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  });</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// ... 像使用其他一般组件一样使用 `AsyncComp`</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">defineAsyncComponent</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AsyncComp</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineAsyncComponent</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;./components/MyComponent.vue&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
<p>最后得到的 <code>AsyncComp</code> 是一个外层包装过的组件，仅在页面需要它渲染时才会调用加载内部实际组件的函数。它会将接收到的 <code>props</code> 和插槽传给内部组件，所以你可以使用这个异步的包装组件无缝地替换原始组件，同时实现延迟加载。</p>
</li>
<li><p>全局注册和父组件定义</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">component</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #98C379">&quot;MyComponent&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">defineAsyncComponent</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;./components/MyComponent.vue&quot;</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">defineAsyncComponent</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AdminPage</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineAsyncComponent</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;./components/AdminPageComponent.vue&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">AdminPage</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>加载与错误状态<br>异步操作不可避免地会涉及到加载和错误状态，因此 <code>defineAsyncComponent()</code> 也支持在高级选项中处理这些状态：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">AsyncComp</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineAsyncComponent</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 加载函数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">loader</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;./Foo.vue&quot;</span><span style="color: #ABB2BF">),</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 加载异步组件时使用的组件</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">loadingComponent</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">LoadingComponent</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 展示加载组件前的延迟时间，默认为 200ms</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">delay</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">200</span><span style="color: #ABB2BF">,</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 加载失败后展示的组件</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">errorComponent</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">ErrorComponent</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果提供了一个 timeout 时间限制，并超时了</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 也会显示这里配置的报错组件，默认值是：Infinity</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">timeout</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">3000</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
<p>如果提供了一个加载组件，它将在内部组件加载时先行显示。在加载组件显示之前有一个默认的 <code>200ms</code> 延迟——这是因为在网络状况较好时，加载完成得很快，加载组件和最终组件之间的替换太快可能产生闪烁，反而影响用户感受。</p>
<p>如果提供了一个报错组件，则它会在加载器函数返回的 <code>Promise</code> 抛错时被渲染。你还可以指定一个超时时间，在请求耗时超过指定时间时也会渲染报错组件。</p>
</li>
</ol>
<h2 id="逻辑复用"><a href="#逻辑复用" class="headerlink" title="逻辑复用"></a>逻辑复用</h2><h3 id="组合式函数"><a href="#组合式函数" class="headerlink" title="组合式函数"></a>组合式函数</h3><div class="note success flat"><p>Vue 的组合式 API 逻辑服用很大程度上借鉴了<code>React Hooks</code>的使用，核心目的为将一个函数或者逻辑抽离到一个文件中形成复用。</p>
</div>
<ol>
<li><p>异步状态示例</p>
<ul>
<li><p><code>App.vue</code></p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">computed</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">useFetch</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./useFetch.js&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">baseUrl</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;https://jsonplaceholder.typicode.com/todos/&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">id</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;1&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">url</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">computed</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">baseUrl</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">id</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">retry</span><span style="color: #ABB2BF"> } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useFetch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  Load post id:</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">5</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">i</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">error</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;Oops! Error encountered: {{ </span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">message</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">retry</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Retry&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-else-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">data</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    Data loaded:</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">pre</span><span style="color: #ABB2BF">&gt;{{ </span><span style="color: #E06C75">data</span><span style="color: #ABB2BF"> }}&lt;/</span><span style="color: #E06C75">pre</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-else</span><span style="color: #ABB2BF">&gt;Loading...&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p><code>useFetch.js</code></p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">watchEffect</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">toValue</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useFetch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">url</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">watchEffect</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">async</span><span style="color: #ABB2BF"> () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// reset state before fetching..</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// resolve the url value synchronously so it&#39;s tracked as a</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// dependency by watchEffect()</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">urlValue</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">toValue</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">url</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// artificial delay / random error</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">timeout</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// unref() will return the ref value if it&#39;s a ref</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// otherwise the value will be returned as-is</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">fetch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">urlValue</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">data</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">await</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">res</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">json</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">    } </span><span style="color: #C678DD">catch</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">e</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">error</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">e</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">data</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">error</span><span style="color: #ABB2BF"> };</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// artificial delay</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">timeout</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">resolve</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">reject</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">setTimeout</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">Math</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">random</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.3</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">resolve</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">      } </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">reject</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">new</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Error</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;Random Error&quot;</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">      }</span></span>
<span class="line"><span style="color: #ABB2BF">    }, </span><span style="color: #D19A66">300</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  });</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<div class="note info flat"><p><code>toValue()</code> 是一个在 <code>3.3</code> 版本中新增的 <code>API</code>。它的设计目的是将 <code>ref</code> 或 <code>getter</code> 规范化为值。如果参数是 <code>ref</code>，它会返回 <code>ref</code> 的值；如果参数是函数，它会调用函数并返回其返回值。否则，它会原样返回参数。它的工作方式类似于 <code>unref()</code>，但对函数有特殊处理。</p>
</div>
</li>
</ul>
</li>
<li><p>约定与最佳实践</p>
<ul>
<li>命名：组合式函数约定用驼峰命名法命名，并以 <code>use</code> 作为开头。</li>
<li><p>输入参数：即便不依赖于 <code>ref</code> 或 <code>getter</code> 的响应性，组合式函数也可以接收它们作为参数。如果你正在编写一个可能被其他开发者使用的组合式函数，最好处理一下输入参数是 <code>ref</code> 或 <code>getter</code> 而非原始值的情况。可以利用 <code>toValue()</code> 工具函数来实现：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">toValue</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useFeature</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">maybeRefOrGetter</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果 maybeRefOrGetter 是一个 ref 或 getter，</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 将返回它的规范化值。</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 否则原样返回。</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">toValue</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">maybeRefOrGetter</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>如果你的组合式函数在输入参数是 <code>ref</code> 或 <code>getter</code> 的情况下创建了响应式 <code>effect</code>，为了让它能够被正确追踪，请确保要么使用 <code>watch()</code> 显式地监视 <code>ref</code> 或 <code>getter</code>，要么在 <code>watchEffect()</code> 中调用 <code>toValue()</code>，以确保能在<code>await</code>之前正确追踪依赖。</p>
</div>
</li>
<li><p>返回值：你可能已经注意到了，我们一直在组合式函数中使用 <code>ref()</code> 而不是 <code>reactive()</code>。我们推荐的约定是组合式函数始终返回一个包含多个 <code>ref</code> 的普通的非响应式对象，这样该对象在组件中被解构为 <code>ref</code> 之后仍可以保持响应性：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// x 和 y 是两个 ref</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">y</span><span style="color: #ABB2BF"> } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useMouse</span><span style="color: #ABB2BF">();</span></span></code></pre></div></div></figure>
<p>从组合式函数返回一个响应式对象会导致在对象解构过程中丢失与组合式函数内状态的响应性连接。与之相反，<code>ref</code> 则可以维持这一响应性连接。<br>如果你更希望以对象属性的形式来使用组合式函数中返回的状态，你可以将返回的对象用 <code>reactive()</code> 包装一次，这样其中的 <code>ref</code> 会被自动解包，例如：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">mouse</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">useMouse</span><span style="color: #ABB2BF">());</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// mouse.x 链接到了原来的 x ref</span></span>
<span class="line"><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">mouse</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">Mouse position is at: {{ </span><span style="color: #E5C07B">mouse</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> }}, {{ </span><span style="color: #E5C07B">mouse</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">y</span><span style="color: #ABB2BF"> }}</span></span></code></pre></div></div></figure>
</li>
<li><p>副作用</p>
<p>在组合式函数中的确可以执行副作用 (例如：添加 <code>DOM</code> 事件监听器或者请求数据)，但请注意以下规则：<br>如果你的应用用到了服务端渲染 (<code>SSR</code>)，请确保在组件挂载后才调用的生命周期钩子中执行 DOM 相关的副作用，例如：onMounted()。这些钩子仅会在浏览器中被调用，因此可以确保能访问到 <code>DOM</code>。<br>确保在 <code>onUnmounted()</code> 时清理副作用。举例来说，如果一个组合式函数设置了一个事件监听器，它就应该在 <code>onUnmounted()</code> 中被移除 (就像我们在 <code>useMouse()</code> 示例中看到的一样)。当然也可以像之前的 <code>useEventListener()</code> 示例那样，使用一个组合式函数来自动帮你做这些事。</p>
</li>
<li><p>使用限制</p>
<p>组合式函数只能在 <code>&lt;script setup&gt;</code> 或 <code>setup()</code> 钩子中被调用。在这些上下文中，它们也只能被同步调用。在某些情况下，你也可以在像 <code>onMounted()</code> 这样的生命周期钩子中调用它们。</p>
<p>这些限制很重要，因为这些是 <code>Vue</code> 用于确定当前活跃的组件实例的上下文。访问活跃的组件实例很有必要，这样才能：</p>
<ol>
<li><p>将生命周期钩子注册到该组件实例上。</p>
</li>
<li><p>将计算属性和监听器注册到该组件实例上，以便在该组件被卸载时停止监听，避免内存泄漏。</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>和无渲染组件的对比<br>我们推荐在<strong>纯逻辑复用</strong>时使用组合式函数，在需要<strong>同时复用逻辑和视图布局</strong>时使用无渲染组件。</p>
<details class="folding-tag" green><summary> 插件无渲染组件的示例 </summary>
              <div class='content'>
                 <div class="note info flat"><p>如果我们将这个概念拓展一下，可以想象的是，一些组件可能只包括了逻辑而不需要自己渲染内容，视图输出通过作用域插槽全权交给了消费者组件。我们将这种类型的组件称为<strong>无渲染组件</strong>。</p></div><ol><li><p><code>App.vue</code></p><figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">MouseTracker</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./MouseTracker.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">MouseTracker</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-slot</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    Mouse is at: {{ </span><span style="color: #E06C75">x</span><span style="color: #ABB2BF"> }}, {{ </span><span style="color: #E06C75">y</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E5C07B">MouseTracker</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li><li><p><code>MouseTracker.vue</code></p><figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onMounted</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onUnmounted</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">y</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">update</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">x</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">pageX</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">y</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">pageY</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onMounted</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">addEventListener</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;mousemove&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">update</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #61AFEF">onUnmounted</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">window</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">removeEventListener</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;mousemove&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">update</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">x</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">x</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">y</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">y</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure></li></ol>
              </div>
            </details>
</li>
</ol>
<h3 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h3><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><ol>
<li><p>在<code>&lt;script setup&gt;</code>中：在<code>&lt;script setup&gt;</code> 中，任何以 <code>v</code> 开头的驼峰式命名的变量都可以被用作一个自定义指令。在上面的例子中，<code>vFocus</code> 即可以在模板中以 <code>v-focus</code> 的形式使用。</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在模板中启用 v-focus</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 假设你还未点击页面中的其他地方，那么上面这个 input 元素应该会被自动聚焦。该指令比 autofocus attribute 更有用，因为它不仅仅可以在页面加载完成后生效，还可以在 Vue 动态插入元素后生效。</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">vFocus</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">mounted</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">el</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">focus</span><span style="color: #ABB2BF">(),</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-focus</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>选项式<code>api</code>：在没有使用 <code>&lt;script setup&gt;</code> 的情况下，自定义指令需要通过 <code>directives</code> 选项注册：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">default</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">setup</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">/*...*/</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">directives</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 在模板中启用 v-focus</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">focus</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">/* ... */</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre></div></div></figure>
</li>
<li><p>全局注册</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createApp</span><span style="color: #ABB2BF">({});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 使 v-focus 在所有组件中都可用</span></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">directive</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;focus&quot;</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/* ... */</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
<div class="note success flat"><p>只有当所需功能只能通过直接的 <code>DOM</code> 操作来实现时，才应该使用自定义指令。其他情况下应该尽可能地使用 <code>v-bind</code> 这样的内置指令来声明式地使用模板，这样更高效，也对服务端渲染更友好。</p>
</div>
</li>
</ol>
<h4 id="指令钩子"><a href="#指令钩子" class="headerlink" title="指令钩子"></a>指令钩子</h4><ol>
<li><p>基本使用</p>
<p>一个指令的定义对象可以提供几种钩子函数 (都是可选的)：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">myDirective</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在绑定元素的 attribute 前</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 或事件监听器应用前调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">created</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">vnode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prevVnode</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 下面会介绍各个参数的细节</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在元素被插入到 DOM 前调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">beforeMount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">vnode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prevVnode</span><span style="color: #ABB2BF">) {},</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在绑定元素的父组件</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 及他自己的所有子节点都挂载完成后调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">mounted</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">vnode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prevVnode</span><span style="color: #ABB2BF">) {},</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 绑定元素的父组件更新前调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">beforeUpdate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">vnode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prevVnode</span><span style="color: #ABB2BF">) {},</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在绑定元素的父组件</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 及他自己的所有子节点都更新后调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">updated</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">vnode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prevVnode</span><span style="color: #ABB2BF">) {},</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 绑定元素的父组件卸载前调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">beforeUnmount</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">vnode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prevVnode</span><span style="color: #ABB2BF">) {},</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 绑定元素的父组件卸载后调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">unmounted</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">vnode</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">prevVnode</span><span style="color: #ABB2BF">) {},</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre></div></div></figure>
</li>
<li><p>钩子参数<br>指令的钩子会传递以下几种参数：</p>
<ul>
<li><p><code>el</code>：指令绑定到的元素。这可以用于直接操作 <code>DOM</code>。</p>
</li>
<li><p><code>binding</code>：一个对象，包含以下属性。</p>
<ul>
<li><code>value</code>：传递给指令的值。例如在 <code>v-my-directive=&quot;1 + 1&quot;</code> 中，值是 2。</li>
<li><code>oldValue</code>：之前的值，仅在 <code>beforeUpdate</code> 和 <code>updated</code> 中可用。无论值是否更改，它都可用。</li>
<li><code>arg</code>：传递给指令的参数 (如果有的话)。例如在 <code>v-my-directive:foo</code> 中，参数是 <code>&quot;foo&quot;</code>。</li>
<li><code>modifiers</code>：一个包含修饰符的对象 (如果有的话)。例如在 <code>v-my-directive.foo.bar</code> 中，修饰符对象是 <code>&#123; foo: true, bar: true &#125;</code>。</li>
<li><code>instance</code>：使用该指令的组件实例。</li>
<li><code>dir</code>：指令的定义对象。</li>
</ul>
</li>
<li><p><code>vnode</code>：代表绑定元素的底层 <code>VNode</code>。</p>
</li>
<li><p><code>prevNode</code>：代表之前的渲染中指令所绑定元素的 <code>VNode</code>。仅在 <code>beforeUpdate</code> 和 <code>updated</code> 钩子中可用。</p>
</li>
</ul>
<p>举例来说，像下面这样使用指令：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-example</span><span style="color: #ABB2BF">:</span><span style="color: #D19A66">foo</span><span style="color: #ABB2BF">.</span><span style="color: #D19A66">bar</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">baz</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p><code>binding</code>参数是一个这样的对象</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">{</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">arg</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;foo&#39;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">modifiers</span><span style="color: #ABB2BF">: { </span><span style="color: #E06C75">bar</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #7F848E; font-style: italic">/* `baz` 的值 */</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">oldValue</span><span style="color: #ABB2BF">: </span><span style="color: #7F848E; font-style: italic">/* 上一次更新时 `baz` 的值 */</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<p>和内置指令类似，自定义指令的参数也可以是动态的。举例来说：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-example</span><span style="color: #ABB2BF">:[</span><span style="color: #D19A66">arg</span><span style="color: #ABB2BF">]=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 这里指令的参数会基于组件的 arg 数据属性响应式地更新。 --&gt;</span></span></code></pre></div></div></figure>
<div class="note success flat"><p>除了 <code>el</code> 外，其他参数都是只读的，不要更改它们。若你需要在不同的钩子间共享信息，推荐通过元素的 <code>dataset</code> <code>attribute</code> 实现。</p>
</div>
</li>
</ol>
<h4 id="简化形式"><a href="#简化形式" class="headerlink" title="简化形式"></a>简化形式</h4><p>对于自定义指令来说，一个很常见的情况是仅仅需要在 <code>mounted</code> 和 <code>updated</code> 上实现相同的行为，除此之外并不需要其他钩子。这种情况下我们可以直接用一个函数来定义指令，如下所示：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-color</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 如果你的指令需要多个值，你可以向它传递一个 JavaScript 对象字面量。别忘了，指令也可以接收任何合法的 JavaScript 表达式。 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-demo</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;white&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;hello!&#39;</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">directive</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;color&quot;</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 这会在 `mounted` 和 `updated` 时都调用</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">el</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">style</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">color</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">binding</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">directive</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;demo&quot;</span><span style="color: #ABB2BF">, (</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">binding</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">color</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// =&gt; &quot;white&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">binding</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">text</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// =&gt; &quot;hello!&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
<h4 id="在组件上使用"><a href="#在组件上使用" class="headerlink" title="在组件上使用"></a>在组件上使用</h4><p>当在组件上使用自定义指令时，它会始终应用于组件的根节点，和透传 <code>attributes</code> 类似。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyComponent</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-demo</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">test</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- MyComponent 的模板 --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- v-demo 指令会被应用在此处 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;My component content&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>需要注意的是组件可能含有多个根节点。当应用到一个多根组件时，指令将会被忽略且抛出一个警告。和 <code>attribute</code> 不同，指令不能通过 <code>v-bind=&quot;$attrs&quot;</code> 来传递给一个不同的元素。总的来说，不推荐在组件上使用自定义指令。</p>
</div>
<details class="folding-tag" green><summary> 查看使用自定义指令实现图片懒加载的部分 </summary>
              <div class='content'>
              <figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">useIntersectionObserver</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;@vueuse/core&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">lazyPlugin</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">install</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">app</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">directive</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;img-lazy&quot;</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">mounted</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">binding</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> { </span><span style="color: #E5C07B">stop</span><span style="color: #ABB2BF"> } </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useIntersectionObserver</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">el</span><span style="color: #ABB2BF">, ([{ </span><span style="color: #E06C75; font-style: italic">isIntersecting</span><span style="color: #ABB2BF"> }]) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">isIntersecting</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #E5C07B">el</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">src</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">binding</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #61AFEF">stop</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">          }</span></span>
<span class="line"><span style="color: #ABB2BF">        });</span></span>
<span class="line"><span style="color: #ABB2BF">      },</span></span>
<span class="line"><span style="color: #ABB2BF">    });</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre></div></div></figure>
              </div>
            </details>
<h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><ol>
<li><p>基本使用</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">createApp</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">createApp</span><span style="color: #ABB2BF">({});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">use</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">myPlugin</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/* 可选的选项 */</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">myPlugin</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">install</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">app</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 配置此应用</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span></code></pre></div></div></figure>
<p>插件没有严格定义的使用范围，但是插件发挥作用的常见场景主要包括以下几种：</p>
<ol>
<li><p>通过 <code>app.component()</code> 和 <code>app.directive()</code> 注册一到多个全局组件或自定义指令。</p>
</li>
<li><p>通过 <code>app.provide()</code> 使一个资源可被注入进整个应用。</p>
</li>
<li><p>向 <code>app.config.globalProperties</code> 中添加一些全局实例属性或方法</p>
</li>
<li><p>一个可能上述三种都包含了的功能库 (例如 <code>vue-router</code>)。</p>
</li>
</ol>
</li>
<li><p>插件示例</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// plugins/i18n.js</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">default</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">install</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">app</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">options</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// 注入一个全局可用的 $translate() 方法</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">config</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">globalProperties</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">$translate</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 获取 `options` 对象的深层属性，即选择对应的语言读取对象，层层读入</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// 使用 `key` 作为索引</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">key</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;.&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">reduce</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">o</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">i</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">o</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">o</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">i</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF">      }, </span><span style="color: #E06C75">options</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    };</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// main.js</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">i18nPlugin</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./plugins/i18n&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">app</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">use</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">i18nPlugin</span><span style="color: #ABB2BF">, {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">greetings</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">hello</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;Bonjour!&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
</ol>
<h2 id="内置组件"><a href="#内置组件" class="headerlink" title="内置组件"></a>内置组件</h2><h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><ol>
<li><p>基本使用</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Toggle&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">   &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;hello&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki css"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/* 下面我们会解释这些 class 是做什么的 */</span></span>
<span class="line"><span style="color: #D19A66">.v-enter-active</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.v-leave-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: opacity </span><span style="color: #D19A66">0.5</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.v-enter-from</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.v-leave-to</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Toggle&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;slide-fade&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;hello&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki css"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/*</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   进入和离开动画可以使用不同</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   持续时间和速度曲线。</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span>
<span class="line"><span style="color: #D19A66">.slide-fade-enter-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: </span><span style="color: #D19A66">all</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.3</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease-out</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.slide-fade-leave-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: </span><span style="color: #D19A66">all</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.8</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">cubic-bezier</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.8</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.slide-fade-enter-from</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.slide-fade-leave-to</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transform: </span><span style="color: #56B6C2">translateX</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">20</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p><code>&lt;Transition&gt;</code> 仅支持单个元素或组件作为其插槽内容。如果内容是一个组件，这个组件必须仅有一个根元素。</p>
</div>
</li>
<li><p>触发时机</p>
<ul>
<li>由 <code>v-if</code> 所触发的切换</li>
<li>由 <code>v-show</code> 所触发的切换</li>
<li>由特殊元素 <code>&lt;component&gt;</code> 切换的动态组件</li>
<li>改变特殊的 <code>key</code> 属性</li>
</ul>
</li>
<li><p><code>CSS</code>过渡<code>class</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/12/04/inMGDdt4h2c1Asl.png" alt=""></p>
</li>
<li><p>为过渡效果命名</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;fade&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  ...</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki css"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #D19A66">.fade-enter-active</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.fade-leave-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: opacity </span><span style="color: #D19A66">0.5</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.fade-enter-from</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.fade-leave-to</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
</li>
<li><p><code>CSS</code>的<code>animation</code></p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;bounce&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">text-align: </span><span style="color: #D19A66">center</span><span style="color: #ABB2BF">;</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    Hello here is some bouncy text!</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki css"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #D19A66">.bounce-enter-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  animation: bounce-in </span><span style="color: #D19A66">0.5</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #D19A66">.bounce-leave-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  animation: bounce-in </span><span style="color: #D19A66">0.5</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">reverse</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #C678DD">@keyframes</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75; font-style: italic">bounce-in</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  0% {</span></span>
<span class="line"><span style="color: #ABB2BF">    transform: </span><span style="color: #56B6C2">scale</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  50% {</span></span>
<span class="line"><span style="color: #ABB2BF">    transform: </span><span style="color: #56B6C2">scale</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.25</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">  100% {</span></span>
<span class="line"><span style="color: #ABB2BF">    transform: </span><span style="color: #56B6C2">scale</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  }</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
</li>
<li><p>自定义过渡<code>class</code><br>你也可以向 <code>&lt;Transition&gt;</code> 传递以下的 <code>props</code> 来指定自定义的过渡 <code>class</code>：</p>
<ul>
<li><code>enter-from-class</code></li>
<li><code>enter-active-class</code></li>
<li><code>enter-to-class</code></li>
<li><code>leave-from-class</code></li>
<li><code>leave-active-class</code></li>
<li><code>leave-to-class</code></li>
</ul>
<div class="note success flat"><p>你传入的这些 <code>class</code> 会覆盖相应阶段的默认 <code>class</code> 名。这个功能在你想要在 <code>Vue</code> 的动画机制下集成其他的第三方 <code>CSS</code> 动画库时非常有用，比如 <code>Animate.css</code>：</p>
</div>
</li>
<li><p>同时使用<code>transition</code>与<code>animation</code><br>然而在某些场景中，你或许想要在同一个元素上同时使用它们两个。举例来说，<code>Vue</code> 触发了一个 <code>CSS</code> 动画，同时鼠标悬停触发另一个 <code>CSS</code> 过渡。此时你需要显式地传入 <code>type prop</code> 来声明，告诉 <code>Vue</code> 需要关心哪种类型，传入的值是 <code>animation</code> 或 <code>transition</code>：即只关心一个。</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;animation&quot;</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>深层级过渡与显式过渡时长<br>默认情况下，<code>&lt;Transition&gt;</code> 组件会通过监听过渡根元素上的第一个 <code>transitionend</code> 或者 <code>animationend</code> 事件来尝试自动判断过渡何时结束。而在嵌套的过渡中，期望的行为应该是等待所有内部元素的过渡完成。</p>
<p>在这种情况下，你可以通过向 <code>&lt;Transition&gt;</code> 组件传入 <code>duration prop</code> 来显式指定过渡的持续时间 (以毫秒为单位)。总持续时间应该匹配延迟加上内部元素的过渡持续时间：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">duration</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #D19A66">550</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;outer&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;inner&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      Hello</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 如果有必要的话，你也可以用对象的形式传入，分开指定进入和离开所需的时间： --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">duration</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">enter</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">500</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">leave</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">800</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;...&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki css"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/* 应用于嵌套元素的规则 */</span></span>
<span class="line"><span style="color: #D19A66">.nested-enter-active</span><span style="color: #C678DD"> </span><span style="color: #D19A66">.inner</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.nested-leave-active</span><span style="color: #C678DD"> </span><span style="color: #D19A66">.inner</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transition-delay: </span><span style="color: #D19A66">0.25</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: </span><span style="color: #D19A66">all</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.3</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease-in-out</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.nested-enter-from</span><span style="color: #C678DD"> </span><span style="color: #D19A66">.inner</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.nested-leave-to</span><span style="color: #C678DD"> </span><span style="color: #D19A66">.inner</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transform: </span><span style="color: #56B6C2">translateX</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">30</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* ... 省略了其他必要的 CSS */</span></span></code></pre></div></div></figure>
</li>
<li><p>JS 钩子<br>你可以通过监听 <code>&lt;Transition&gt;</code> 组件事件的方式在过渡过程中挂上钩子函数：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">before-enter</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onBeforeEnter</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">enter</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onEnter</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">after-enter</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onAfterEnter</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">enter-cancelled</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onEnterCancelled</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">before-leave</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onBeforeLeave</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">leave</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onLeave</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">after-leave</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onAfterLeave</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">  @</span><span style="color: #D19A66">leave-cancelled</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onLeaveCancelled</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!-- ... --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// 在元素被插入到 DOM 之前被调用</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 用这个来设置元素的 &quot;enter-from&quot; 状态</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onBeforeEnter</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在元素被插入到 DOM 之后的下一帧被调用</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 用这个来开始进入动画</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onEnter</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">done</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 调用回调函数 done 表示过渡结束</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果与 CSS 结合使用，则这个回调是可选参数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">done</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 当进入过渡完成时调用。</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onAfterEnter</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 当进入过渡在完成之前被取消时调用</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onEnterCancelled</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在 leave 钩子之前调用</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 大多数时候，你应该只会用到 leave 钩子</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onBeforeLeave</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在离开过渡开始时调用</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 用这个来开始离开动画</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onLeave</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">done</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 调用回调函数 done 表示过渡结束</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 如果与 CSS 结合使用，则这个回调是可选参数</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">done</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 在离开过渡完成、</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 且元素已从 DOM 中移除时调用</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onAfterLeave</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 仅在 v-show 过渡中可用</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onLeaveCancelled</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">el</span><span style="color: #ABB2BF">) {}</span></span></code></pre></div></div></figure>
<p>这些钩子可以与 <code>CSS</code> 过渡或动画结合使用，也可以单独使用。</p>
<p>在使用仅由 <code>JavaScript</code> 执行的动画时，最好是添加一个 <code>:css=&quot;false&quot; prop</code>。这显式地向 <code>Vue</code> 表明可以跳过对 <code>CSS</code> 过渡的自动探测。除了性能稍好一些之外，还可以防止 <code>CSS</code> 规则意外地干扰过渡效果。<br>在有了 <code>:css=&quot;false&quot;</code> 后，我们就自己全权负责控制什么时候过渡结束了。这种情况下对于 <code>@enter</code> 和 <code>@leave</code> 钩子来说，回调函数 <code>done</code> 就是必须的。否则，钩子将被同步调用，过渡将立即完成。</p>
</li>
<li><p>可复用过渡效果<br>有点类似无渲染组件</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- MyTransition.vue --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// JavaScript 钩子逻辑...</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">&lt;!-- 包装内置的 Transition 组件 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;my-transition&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">enter</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onEnter</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">leave</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">onLeave</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">&lt;!-- 向内传递插槽内容 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/*</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   必要的 CSS...</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   注意：避免在这里使用 &lt;style scoped&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   因为那不会应用到插槽内容上</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyTransition</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Hello&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">MyTransition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>元素间过渡</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">docState</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;saved&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">style</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">margin-right: </span><span style="color: #D19A66">20</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Click to cycle through states:&lt;/</span><span style="color: #E06C75">span</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;btn-container&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;slide-up&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">docState</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;saved&#39;</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">docState</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;edited&#39;</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        Edit</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">button</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">v-else-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">docState</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;edited&#39;</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">        @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">docState</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;editing&#39;</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">      &gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        Save</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">button</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">v-else-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">docState</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;editing&#39;</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">        @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">docState</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;saved&#39;</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">      &gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        Cancel</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #D19A66">.btn-container</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  display: </span><span style="color: #D19A66">inline-block</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  position: </span><span style="color: #D19A66">relative</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  height: </span><span style="color: #D19A66">1</span><span style="color: #E06C75">em</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  position: </span><span style="color: #D19A66">absolute</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.slide-up-enter-active</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.slide-up-leave-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: </span><span style="color: #D19A66">all</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.25</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease-out</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.slide-up-enter-from</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  transform: </span><span style="color: #56B6C2">translateY</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">30</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.slide-up-leave-to</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  transform: </span><span style="color: #56B6C2">translateY</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">-30</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>过渡模式<br>在之前的例子中，进入和离开的元素都是在同时开始动画的，因此我们不得不将它们设为 <code>position: absolute</code> 以避免二者同时存在时出现的布局问题。（利用定位元素可以互相重叠覆盖）</p>
<p>然而，很多情况下这可能并不符合需求。我们可能想要先执行离开动画，然后在其完成之后再执行元素的进入动画。手动编排这样的动画是非常复杂的，好在我们可以通过向 <code>&lt;Transition&gt;</code> 传入一个 <code>mode prop</code> 来实现这个行为：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">mode</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;out-in&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  ...</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>组件间过渡</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;fade&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">mode</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;out-in&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">activeComponent</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>动态过渡</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">Transition</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">transitionName</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;!-- ... --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">Transition</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="TransitionGroup"><a href="#TransitionGroup" class="headerlink" title="TransitionGroup"></a>TransitionGroup</h3><ol>
<li><p>和<code>Transition</code>的区别<br><code>&lt;TransitionGroup&gt;</code> 支持和 <code>&lt;Transition&gt;</code> 基本相同的 <code>props</code>、<code>CSS</code> 过渡 <code>class</code> 和 <code>JavaScript</code> 钩子监听器，但有以下几点区别：</p>
<ul>
<li><p>默认情况下，它不会渲染一个容器元素。但你可以通过传入 <code>tag prop</code> 来指定一个元素作为容器元素来渲染。</p>
</li>
<li><p>过渡模式在这里不可用，因为我们不再是在互斥的元素之间进行切换。</p>
</li>
<li><p>列表中的每个元素都必须有一个独一无二的 <code>key attribute</code>。</p>
</li>
<li><p><code>CSS</code> 过渡 <code>class</code> 会被应用在列表内的元素上，而不是容器元素上。</p>
</li>
</ul>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">TransitionGroup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;list&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">tag</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ul&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">items</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">key</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">item</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    {{ </span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> }}</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">li</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">TransitionGroup</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki css"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">/* 对移动中的元素应用的过渡 */</span></span>
<span class="line"><span style="color: #D19A66">.list-move</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.list-enter-active</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.list-leave-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: </span><span style="color: #D19A66">all</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.5</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.list-enter-from</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.list-leave-to</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  transform: </span><span style="color: #56B6C2">translateX</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">30</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* 确保将离开的元素从布局流中删除</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   以便能够正确地计算移动的动画。 */</span></span>
<span class="line"><span style="color: #D19A66">.list-leave-active</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  position: </span><span style="color: #D19A66">absolute</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://cn.vuejs.org/examples/#list-transition">经典示例</a></p>
</blockquote>
</li>
</ol>
<h3 id="KeepAlive"><a href="#KeepAlive" class="headerlink" title="KeepAlive"></a>KeepAlive</h3><ol>
<li><p>基本使用</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 非活跃的组件将会被缓存！ --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF"> &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">activeComponent</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 路由懒加载 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">router-view</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-slot</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF"> &lt;</span><span style="color: #E06C75">keep-alive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">   &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF"> &lt;/</span><span style="color: #E06C75">keep-alive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">router-view</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>包含与排除<br><code>&lt;KeepAlive&gt;</code> 默认会缓存内部的所有组件实例，但我们可以通过 <code>include</code> 和 <code>exclude prop</code> 来定制该行为。这两个 <code>prop</code> 的值都可以是一个以英文逗号分隔的字符串、一个正则表达式，或是包含这两种类型的一个数组：</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 以英文逗号分隔的字符串 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">include</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;a,b&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF"> &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">view</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 正则表达式 (需使用 `v-bind`) --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">include</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">/a</span><span style="color: #ABB2BF">|</span><span style="color: #E06C75">b/</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">view</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 数组 (需使用 `v-bind`) --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">include</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&#39;a&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;b&#39;</span><span style="color: #ABB2BF">]</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">view</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>它会根据组件的 <code>name</code> 选项进行匹配，所以组件如果想要条件性地被 <code>KeepAlive</code> 缓存，就必须显式声明一个 <code>name</code> 选项。</p>
<div class="note success flat"><p>在 3.2.34 或以上的版本中，使用 <code>&lt;script setup&gt;</code> 的单文件组件会自动根据文件名生成对应的 <code>name</code> 选项，无需再手动声明。</p>
</div>
</li>
<li><p>最大缓存实例数</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">max</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">activeComponent</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>缓存实例的生命周期</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">onActivated</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onDeactivated</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onActivated</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 调用时机为首次挂载</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 以及每次从缓存中被重新插入时</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onDeactivated</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 在从 DOM 上移除、进入缓存</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 以及组件卸载时调用</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<div class="note warning flat"><ul>
<li><p><code>onActivated</code> 在组件挂载时也会调用，并且 <code>onDeactivated</code> 在组件卸载时也会调用。</p>
</li>
<li><p>这两个钩子不仅适用于 <code>&lt;KeepAlive&gt;</code> 缓存的根组件，也适用于缓存树中的后代组件。</p>
</li>
</ul>
</div>
</li>
</ol>
<h3 id="Teleport"><a href="#Teleport" class="headerlink" title="Teleport"></a>Teleport</h3><blockquote>
<p><code>&lt;Teleport&gt;</code> 是一个内置组件，它可以将一个组件内部的一部分模板“传送”到该组件的 <code>DOM</code> 结构外层的位置去。</p>
</blockquote>
<ol>
<li><p>模态框示例</p>
<ul>
<li><p><code>App.vue</code></p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!--</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   可定制插槽和 CSS 过渡效果的模态框组件。</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">Modal</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./Modal.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">showModal</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;show-modal&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">showModal</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;Show Modal&lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">to</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;body&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">&lt;!-- 使用这个 modal 组件，传入 prop --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">modal</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">show</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">showModal</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">close</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">showModal</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">header</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">h3</span><span style="color: #ABB2BF">&gt;custom header&lt;/</span><span style="color: #E06C75">h3</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">modal</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p><code>Modal.vue</code></p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Boolean</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modal&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">show</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modal-mask&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modal-container&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modal-header&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;header&quot;</span><span style="color: #ABB2BF">&gt;default header&lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modal-body&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;body&quot;</span><span style="color: #ABB2BF">&gt;default body&lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modal-footer&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          &lt;</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">name</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;footer&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">            default footer</span></span>
<span class="line"><span style="color: #ABB2BF">            &lt;</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">class</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modal-default-button&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">click</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #61AFEF">$emit</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;close&#39;</span><span style="color: #ABB2BF">)</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">              OK</span></span>
<span class="line"><span style="color: #ABB2BF">            &lt;/</span><span style="color: #E06C75">button</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          &lt;/</span><span style="color: #E06C75">slot</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #D19A66">.modal-mask</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  position: </span><span style="color: #D19A66">fixed</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  z-index: </span><span style="color: #D19A66">9998</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  top: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  left: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  width: </span><span style="color: #D19A66">100</span><span style="color: #E06C75">%</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  height: </span><span style="color: #D19A66">100</span><span style="color: #E06C75">%</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  background-color: </span><span style="color: #56B6C2">rgba</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  display: </span><span style="color: #D19A66">flex</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: opacity </span><span style="color: #D19A66">0.3</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.modal-container</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  width: </span><span style="color: #D19A66">300</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  margin: </span><span style="color: #D19A66">auto</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  padding: </span><span style="color: #D19A66">20</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">30</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  background-color: </span><span style="color: #D19A66">#fff</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  border-radius: </span><span style="color: #D19A66">2</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  box-shadow: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">8</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">rgba</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">0.33</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  transition: </span><span style="color: #D19A66">all</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.3</span><span style="color: #E06C75">s</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ease</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.modal-header</span><span style="color: #C678DD"> </span><span style="color: #E06C75">h3</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  margin-top: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  color: </span><span style="color: #D19A66">#42b983</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.modal-body</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  margin: </span><span style="color: #D19A66">20</span><span style="color: #E06C75">px</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.modal-default-button</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  float: </span><span style="color: #D19A66">right</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/*</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * 对于 transition=&quot;modal&quot; 的元素来说</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * 当通过 Vue.js 切换它们的可见性时</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * 以下样式会被自动应用。</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> *</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * 你可以简单地通过编辑这些样式</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * 来体验该模态框的过渡效果。</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.modal-enter-from</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.modal-leave-to</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  opacity: </span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D19A66">.modal-enter-from</span><span style="color: #C678DD"> </span><span style="color: #D19A66">.modal-container</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #D19A66">.modal-leave-to</span><span style="color: #C678DD"> </span><span style="color: #D19A66">.modal-container</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #56B6C2">-webkit-transform</span><span style="color: #ABB2BF">: </span><span style="color: #56B6C2">scale</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">  transform: </span><span style="color: #56B6C2">scale</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">1.1</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">style</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ul>
</li>
<li><p>搭配组件使用<br><code>&lt;Teleport&gt;</code> 只改变了渲染的 <code>DOM</code> 结构，它不会影响组件间的逻辑关系。也就是说，如果 <code>&lt;Teleport&gt;</code> 包含了一个组件，那么该组件始终和这个使用了 <code>&lt;teleport&gt;</code> 的组件保持逻辑上的父子关系。传入的 <code>props</code> 和触发的事件也会照常工作。</p>
</li>
<li><p>禁用<code>Teleport</code></p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">disabled</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">isMobile</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF"> ...</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>多个 <code>Teleport</code> 共享目标</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">to</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;#modals&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;A&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">to</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;#modals&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;B&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">Teleport</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- 渲染结果 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">id</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;modals&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;A&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;B&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">div</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ol>
<h3 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h3><blockquote>
<p><code>&lt;Suspense&gt;</code> 是一个内置组件，用来在组件树中协调对异步依赖的处理。它让我们可以在组件树上层等待下层的多个嵌套异步依赖项解析完成，并可以在等待时渲染一个加载状态。</p>
</blockquote>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">RouterView</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">v-slot</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">{ </span><span style="color: #E06C75">Component</span><span style="color: #ABB2BF"> }</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-if</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">Component</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">mode</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;out-in&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E5C07B">Suspense</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">&lt;!-- 主要内容 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          &lt;</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">is</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">Component</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF">&gt;&lt;/</span><span style="color: #E06C75">component</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">&lt;!-- 加载中状态 --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          &lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF"> #</span><span style="color: #D19A66">fallback</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">            正在加载...</span></span>
<span class="line"><span style="color: #ABB2BF">          &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;/</span><span style="color: #E5C07B">Suspense</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;/</span><span style="color: #E5C07B">KeepAlive</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E5C07B">Transition</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E5C07B">RouterView</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><h3 id="包体积与-Tree-shaking-优化"><a href="#包体积与-Tree-shaking-优化" class="headerlink" title="包体积与 Tree-shaking 优化"></a>包体积与 Tree-shaking 优化</h3><ol>
<li><p>尽量使用构建版本(<code>Production</code>)</p>
<ul>
<li><code>Tree-shaking</code>减少无用代码。</li>
<li><code>Vue</code>编译器无需载入减少体积，模板会被预编译。</li>
</ul>
</li>
<li><p>在引入新的依赖项时要小心包体积膨胀！尽量使用<code>ES</code>版本的包，其对<code>tree-shaking</code>更加友好。权衡依赖体积与功能的性价比。</p>
</li>
<li><p>代码分割<br>代码分割是指构建工具将构建后的 <code>JavaScript</code> 包拆分为多个较小的，可以按需或并行加载的文件。通过适当的代码分割，页面加载时需要的功能可以立即下载，而额外的块只在需要时才加载，从而提高性能。像 Rollup (Vite 就是基于它之上开发的) 或者 webpack 这样的打包工具可以通过分析 ESM <strong>动态导入</strong>的语法来自动进行代码分割：</p>
<figure class="shiki js"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">// lazy.js 及其依赖会被拆分到一个单独的文件中</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 并只在 `loadLazy()` 调用时才加载</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">loadLazy</span><span style="color: #ABB2BF">() {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;./lazy.js&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">defineAsyncComponent</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 会为 Foo.vue 及其依赖创建单独的一个块</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 它只会按需加载</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">//（即该异步组件在页面中被渲染时）</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Foo</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineAsyncComponent</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">import</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;./Foo.vue&quot;</span><span style="color: #ABB2BF">));</span></span></code></pre></div></div></figure>
<p>对于使用了 Vue Router 的应用，强烈建议使用异步组件作为路由组件。Vue Router 已经显性地支持了独立于 <code>defineAsyncComponent</code> 的懒加载。查看懒加载路由了解更多细节。</p>
</li>
<li><p>保持<code>props</code>的稳定新，移除无用的更新步骤</p>
<figure class="shiki vue-html"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">ListItem</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">list</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E5C07B">item</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">active-id</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">activeId</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">ListItem</span></span>
<span class="line"><span style="color: #ABB2BF"> </span><span style="color: #C678DD">v-for</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">item</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">list</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">id</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E5C07B">item</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF"> :</span><span style="color: #D19A66">active</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E5C07B">item</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">activeId</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>内置指令</p>
<ul>
<li><code>v-once</code>：<code>v-once</code> 是一个内置的指令，可以用来渲染依赖运行时数据但无需再更新的内容。它的整个子树都会在未来的更新中被跳过。</li>
<li><code>v-memo</code>：<code>v-memo</code> 是一个内置指令，可以用来有条件地跳过某些大型子树或者 <code>v-for</code> 列表的更新。</li>
</ul>
</li>
<li><p>虚拟列表</p>
</li>
<li>浅层响应式对象</li>
<li>大型列表中避免不必要的组件抽象。</li>
</ol>
<h3 id="组合式-API-的优势"><a href="#组合式-API-的优势" class="headerlink" title="组合式 API 的优势"></a>组合式 API 的优势</h3><ol>
<li>更好的逻辑复用。</li>
<li>更加灵活的代码组织。</li>
<li>更好的类型推导。<br>近几年来，越来越多的开发者开始使用 <code>TypeScript</code> 书写更健壮可靠的代码，<code>TypeScript</code> 还提供了非常好的 <code>IDE</code> 开发支持。然而选项式 <code>API</code> 是在 <code>2013</code> 年被设计出来的，那时并没有把类型推导考虑进去，因此我们不得不做了一些复杂到夸张的类型体操才实现了对选项式 <code>API</code> 的类型推导。但尽管做了这么多的努力，选项式 <code>API</code> 的类型推导在处理 <code>mixins</code> 和依赖注入类型时依然不甚理想。</li>
<li>更小的生产包体积<br>搭配 <code>&lt;script setup&gt;</code> 使用组合式 API 比等价情况下的选项式 API 更高效，对代码压缩也更友好。这是由于 <code>&lt;script setup&gt;</code> 形式书写的组件模板被编译为了一个内联函数，和 <code>&lt;script setup&gt;</code> 中的代码位于同一作用域。不像选项式 API 需要依赖 <code>this</code> 上下文对象访问属性，被编译的模板可以直接访问 <code>&lt;script setup&gt;</code> 中定义的变量，无需从实例中代理。这对代码压缩更友好，因为本地变量的名字可以被压缩，但对象的属性名则不能。</li>
</ol>
<h3 id="虚拟-DOM-的算法改进"><a href="#虚拟-DOM-的算法改进" class="headerlink" title="虚拟 DOM 的算法改进"></a>虚拟 DOM 的算法改进</h3><ul>
<li>Vue3 使用了<strong>片段</strong>（fragments）的概念，可以让一个组件返回多个根节点，而不需要使用额外的包裹元素。这样可以减少不必要的 DOM 节点，提高渲染效率。</li>
<li>Vue3 使用了<strong>静态标记</strong>（static hoisting）的技术，可以在编译阶段识别出不会改变的静态内容，比如文本、属性、样式等，并将它们提升到渲染函数之外，避免每次重新渲染时都要重新创建。这样可以减少不必要的内存分配和垃圾回收，提高性能。</li>
<li>Vue3 使用了<strong>事件侦听器缓存</strong>（event listener caching）的技术，可以在编译阶段识别出不会改变的事件侦听器，并将它们缓存起来，避免每次重新渲染时都要重新绑定。这样可以减少不必要的事件侦听器的创建和销毁，提高性能。</li>
<li>Vue3 使用了<strong>块跟踪</strong>（block tracking）的技术，可以在编译阶段识别出动态内容的边界，并将它们分割成不同的块，每个块都有一个唯一的标识符。这样可以在运行时只对发生变化的块进行 diff，而不需要遍历整个模板。这样可以减少不必要的比较和更新，提高性能。</li>
<li>Vue3 使用了<strong>优化的 diff 算法</strong>，可以在处理完首尾节点后，对剩余节点的进行更高效的匹配和移动。Vue3 使用了<strong>LCS</strong>（最长公共子序列）的算法，可以找出新旧节点列表中的最长公共子序列，然后将其保持不变，只对非公共子序列的节点进行移动。这样可以减少不必要的节点移动，提高性能。</li>
</ul>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="TypeScript-与组合式-API"><a href="#TypeScript-与组合式-API" class="headerlink" title="TypeScript 与组合式 API"></a>TypeScript 与组合式 API</h3><ol>
<li><p>为组件的 <code>props</code> 标注类型</p>
<ul>
<li><p>运行时声明：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF">: { </span><span style="color: #E06C75">type</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">String</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">required</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF"> },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">bar</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Number</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF">; </span><span style="color: #7F848E; font-style: italic">// string</span></span>
<span class="line"><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">bar</span><span style="color: #ABB2BF">; </span><span style="color: #7F848E; font-style: italic">// number | undefined</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>基于类型的声明</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">&lt;{</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">foo</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">bar</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}&gt;();</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
</ul>
</li>
<li><p><code>props</code>解构默认值<br>当使用基于类型的声明时，我们失去了为 <code>props</code> 声明默认值的能力。这可以通过 <code>withDefaults</code> 编译器宏解决：</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Props</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">msg</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">labels</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">[];</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">withDefaults</span><span style="color: #ABB2BF">(</span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Props</span><span style="color: #ABB2BF">&gt;(), {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">msg</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;hello&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">labels</span><span style="color: #ABB2BF">: () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> [</span><span style="color: #98C379">&quot;one&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;two&quot;</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
<li><p>复杂的<code>prop</code>类型</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Book</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">author</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">year</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">&lt;{</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">book</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Book</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}&gt;();</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>对于运行时声明，我们可以使用 <code>PropType</code> 工具类型：</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">PropType</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineProps</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">book</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">Object</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">PropType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Book</span><span style="color: #ABB2BF">&gt;,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
<li><p>为组件的 <code>emits</code> 标注类型</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 运行时</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">([</span><span style="color: #98C379">&quot;change&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;update&quot;</span><span style="color: #ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 基于类型</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">&lt;{</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;change&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">id</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  (</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;update&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 3.3+: 可选的、更简洁的语法</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">emit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">defineEmits</span><span style="color: #ABB2BF">&lt;{</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">change</span><span style="color: #ABB2BF">: [</span><span style="color: #E06C75">id</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">update</span><span style="color: #ABB2BF">: [</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">];</span></span>
<span class="line"><span style="color: #ABB2BF">}&gt;();</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>为<code>ref</code>标注类型</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 推导出的类型：Ref&lt;number&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">year</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">2020</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// =&gt; TS Error: Type &#39;string&#39; is not assignable to type &#39;number&#39;.</span></span>
<span class="line"><span style="color: #E5C07B">year</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;2020&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">Ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">year</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Ref</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;2020&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">year</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2020</span><span style="color: #ABB2BF">; </span><span style="color: #7F848E; font-style: italic">// 成功！</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 得到的类型：Ref&lt;string | number&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">year</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #98C379">&quot;2020&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E5C07B">year</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2020</span><span style="color: #ABB2BF">; </span><span style="color: #7F848E; font-style: italic">// 成功！</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 推导得到的类型：Ref&lt;number | undefined&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">n</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">&gt;();</span></span></code></pre></div></div></figure>
</li>
<li><p>为<code>reactive</code>标注类型</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">reactive</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 推导得到的类型：{ title: string }</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">book</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;Vue 3 指引&quot;</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">reactive</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Book</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">year</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">book</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Book</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">reactive</span><span style="color: #ABB2BF">({ </span><span style="color: #E06C75">title</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;Vue 3 指引&quot;</span><span style="color: #ABB2BF"> });</span></span></code></pre></div></div></figure>
<div class="note warning flat"><p>不推荐使用 <code>reactive()</code> 的泛型参数，因为处理了深层次 <code>ref</code> 解包的返回值与泛型参数的类型不同。</p>
</div>
</li>
<li><p>为 <code>computed()</code> 标注类型</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">computed</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// 推导得到的类型：ComputedRef&lt;number&gt;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">double</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">computed</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">count</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// =&gt; TS Error: Property &#39;split&#39; does not exist on type &#39;number&#39;</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">result</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">double</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">split</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">double</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">computed</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">&gt;(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// 若返回值不是 number 类型则会报错</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span></code></pre></div></div></figure>
</li>
<li><p>为事件处理函数标注类型</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handleChange</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">event</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">// `event` 隐式地标注为 `any` 类型</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">event</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">type</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;text&quot;</span><span style="color: #ABB2BF"> @</span><span style="color: #D19A66">change</span><span style="color: #ABB2BF">=</span><span style="color: #ABB2BF">&quot;</span><span style="color: #E06C75">handleChange</span><span style="color: #ABB2BF">&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">handleChange</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">event</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Event</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">console</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">log</span><span style="color: #ABB2BF">((</span><span style="color: #E5C07B">event</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">target</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">HTMLInputElement</span><span style="color: #ABB2BF">).</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span></code></pre></div></div></figure>
</li>
<li><p>为 <code>provide / inject</code> 标注类型<br><code>provide</code> 和 <code>inject</code> 通常会在不同的组件中运行。要正确地为注入的值标记类型，<code>Vue</code> 提供了一个 <code>InjectionKey</code> 接口，它是一个继承自 <code>Symbol</code> 的泛型类型，可以用来在提供者和消费者之间同步注入值的类型：</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">provide</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">inject</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">InjectionKey</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">key</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Symbol</span><span style="color: #ABB2BF">() </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">InjectionKey</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">provide</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;foo&quot;</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 若提供的是非字符串值会导致错误</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">foo</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">inject</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">key</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// foo 的类型：string | undefined</span></span></code></pre></div></div></figure>
<p>建议将注入 <code>key</code> 的类型放在一个单独的文件中，这样它就可以被多个组件导入。</p>
<p>当使用字符串注入 <code>key</code> 时，注入值的类型是 <code>unknown</code>，需要通过泛型参数显式声明：</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">foo</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">inject</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #98C379">&quot;foo&quot;</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 类型：string | undefined</span></span></code></pre></div></div></figure>
<p>注意注入的值仍然可以是 <code>undefined</code>，因为无法保证提供者一定会在运行时 <code>provide</code> 这个值。</p>
<p>当提供了一个默认值后，这个 <code>undefined</code> 类型就可以被移除：</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">foo</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">inject</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #98C379">&quot;foo&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;bar&quot;</span><span style="color: #ABB2BF">); </span><span style="color: #7F848E; font-style: italic">// 类型：string</span></span></code></pre></div></div></figure>
<p>如果你确定该值将始终被提供，则还可以强制转换该值：</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">foo</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">inject</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;foo&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span></code></pre></div></div></figure>
</li>
<li><p>为模板引用标注类型</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onMounted</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">el</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">HTMLInputElement</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">null</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">onMounted</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">el</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">?.</span><span style="color: #61AFEF">focus</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">ref</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;el&quot;</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">template</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>为组件模板引用标注类型<br>有时，你可能需要为一个子组件添加一个模板引用，以便调用它公开的方法。举例来说，我们有一个 <code>MyModal</code> 子组件，它有一个打开模态框的方法：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- MyModal.vue --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">isContentShown</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">isContentShown</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">defineExpose</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">open</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">});</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
<p>为了获取 <code>MyModal</code> 的类型，我们首先需要通过 <code>typeof</code> 得到其类型，再使用 <code>TypeScript</code> 内置的 <code>InstanceType</code> 工具类型来获取其实例类型：</p>
<figure class="shiki vue"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic">&lt;!-- App.vue --&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">setup</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">lang</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&quot;ts&quot;</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">MyModal</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;./MyModal.vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">modal</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">InstanceType</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">typeof</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">MyModal</span><span style="color: #ABB2BF">&gt; | </span><span style="color: #E5C07B">null</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">openModal</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> () </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">modal</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">value</span><span style="color: #ABB2BF">?.</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">script</span><span style="color: #ABB2BF">&gt;</span></span></code></pre></div></div></figure>
</li>
<li><p>如果组件的具体类型无法获得，或者你并不关心组件的具体类型，那么可以使用 <code>ComponentPublicInstance</code>。这只会包含所有组件都共享的属性，比如 <code>$el</code>。</p>
<figure class="shiki ts"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ref</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">ComponentPublicInstance</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;vue&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">child</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">ref</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">ComponentPublicInstance</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">null</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #D19A66">null</span><span style="color: #ABB2BF">);</span></span></code></pre></div></div></figure>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://blog.refrain.site">希亚的西红柿</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.refrain.site/posts/3c94855e/">http://blog.refrain.site/posts/3c94855e/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.refrain.site" target="_blank">希亚的西红柿のBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a><a class="post-meta__tags" href="/tags/Front-End/">Front End</a><a class="post-meta__tags" href="/tags/Framework/">Framework</a><a class="post-meta__tags" href="/tags/Vue/">Vue</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/11/25/Tec3u9LNntZhsx6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://npm.elemecdn.com/butterfly-extsrc@latest/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://npm.elemecdn.com/butterfly-extsrc@latest/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/a1605017/" title="React笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/12/04/SxYNCPRkihQHXLn.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">React笔记</div></div></a></div><div class="next-post pull-right"><a href="/posts/adf5c49/" title="Vue2笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/11/24/DdC1QyeWBFzhfGA.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue2笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/adf5c49/" title="Vue2笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/11/24/DdC1QyeWBFzhfGA.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-24</div><div class="title">Vue2笔记</div></div></a></div><div><a href="/posts/a1605017/" title="React笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/12/04/SxYNCPRkihQHXLn.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-04</div><div class="title">React笔记</div></div></a></div><div><a href="/posts/2afbd983/" title="Intersection Observer"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/12/31/jE29xmnMQvqT8oF.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-31</div><div class="title">Intersection Observer</div></div></a></div><div><a href="/posts/b2b6ba06/" title="JS拾遗笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/10/23/VgnNT54UXmAsSrL.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-23</div><div class="title">JS拾遗笔记</div></div></a></div><div><a href="/posts/35a88b44/" title="JS事件循环"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/10/20/HSRtjCFenDq6cGb.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-20</div><div class="title">JS事件循环</div></div></a></div><div><a href="/posts/2275c8/" title="深入了解Promise"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/10/16/9BG4PtNVgiqTQAE.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-16</div><div class="title">深入了解Promise</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/nova1751-sources/blogImg/noa.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">希亚的西红柿</div><div class="author-info__description">个人博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/nova1751"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:nova1751@outlook.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/325854600" rel="external nofollow noreferrer" target="_blank" title="Bilibili"><i class="fab fa-bilibili"></i></a><a class="social-icon" href="https://t.me/nova1751" rel="external nofollow noreferrer" target="_blank" title="Telegram"><i class="fab fa-telegram"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本网站评论系统使用的是 <span class="hl-label" style="background: rgb(73, 177, 245);border-radius: 6px">Twikoo</span>,若头像没有正常显示，请自行前往 <a class="hl-label" target="_blank" rel="noopener external nofollow noreferrer" href="https://cravatar.cn">Cravatar</a>绑定邮箱配置。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-app-%E5%AE%9E%E4%BE%8B%E5%B9%B6%E6%8C%82%E8%BD%BD"><span class="toc-number">1.1.</span> <span class="toc-text">创建一个 app 实例并挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">模板语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%9F%BA%E7%A1%80"><span class="toc-number">1.3.</span> <span class="toc-text">响应式基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7"><span class="toc-number">1.4.</span> <span class="toc-text">计算属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E4%B8%8E%E6%A0%B7%E5%BC%8F%E7%BB%91%E5%AE%9A"><span class="toc-number">1.5.</span> <span class="toc-text">类与样式绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-number">1.6.</span> <span class="toc-text">条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93"><span class="toc-number">1.7.</span> <span class="toc-text">列表渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text">事件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E8%BE%93%E5%85%A5%E7%BB%91%E5%AE%9A"><span class="toc-number">1.9.</span> <span class="toc-text">表单输入绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.10.</span> <span class="toc-text">生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%A6%E5%90%AC%E5%99%A8"><span class="toc-number">1.11.</span> <span class="toc-text">侦听器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%BC%95%E7%94%A8"><span class="toc-number">1.12.</span> <span class="toc-text">模板引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%BB%84%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">深入组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%86%8C"><span class="toc-number">2.1.</span> <span class="toc-text">组件注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Props"><span class="toc-number">2.2.</span> <span class="toc-text">Props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">组件事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6-v-model"><span class="toc-number">2.4.</span> <span class="toc-text">组件 v-model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%8F%E4%BC%A0-Attributes"><span class="toc-number">2.5.</span> <span class="toc-text">透传 Attributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E6%A7%BD"><span class="toc-number">2.6.</span> <span class="toc-text">插槽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">2.7.</span> <span class="toc-text">依赖注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6"><span class="toc-number">2.8.</span> <span class="toc-text">异步组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%A4%8D%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">逻辑复用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%BC%8F%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">组合式函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">自定义指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E9%92%A9%E5%AD%90"><span class="toc-number">3.2.2.</span> <span class="toc-text">指令钩子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8C%96%E5%BD%A2%E5%BC%8F"><span class="toc-number">3.2.3.</span> <span class="toc-text">简化形式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.4.</span> <span class="toc-text">在组件上使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%BB%84%E4%BB%B6"><span class="toc-number">4.</span> <span class="toc-text">内置组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Transition"><span class="toc-number">4.1.</span> <span class="toc-text">Transition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TransitionGroup"><span class="toc-number">4.2.</span> <span class="toc-text">TransitionGroup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeepAlive"><span class="toc-number">4.3.</span> <span class="toc-text">KeepAlive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Teleport"><span class="toc-number">4.4.</span> <span class="toc-text">Teleport</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Suspense"><span class="toc-number">4.5.</span> <span class="toc-text">Suspense</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Feature"><span class="toc-number">5.</span> <span class="toc-text">Feature</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E4%BD%93%E7%A7%AF%E4%B8%8E-Tree-shaking-%E4%BC%98%E5%8C%96"><span class="toc-number">5.1.</span> <span class="toc-text">包体积与 Tree-shaking 优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%BC%8F-API-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">5.2.</span> <span class="toc-text">组合式 API 的优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F-DOM-%E7%9A%84%E7%AE%97%E6%B3%95%E6%94%B9%E8%BF%9B"><span class="toc-number">5.3.</span> <span class="toc-text">虚拟 DOM 的算法改进</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">6.</span> <span class="toc-text">最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeScript-%E4%B8%8E%E7%BB%84%E5%90%88%E5%BC%8F-API"><span class="toc-number">6.1.</span> <span class="toc-text">TypeScript 与组合式 API</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/acc0017d/" title="数据结构与算法笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/12/11/ZmVdnztJ6MRrq7w.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法笔记"/></a><div class="content"><a class="title" href="/posts/acc0017d/" title="数据结构与算法笔记">数据结构与算法笔记</a><time datetime="2024-08-18T06:34:16.000Z" title="更新于 2024-08-18 14:34:16">2024-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/300a8ca5/" title="虚拟列表"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2024/08/07/PguCDbyn4RSfzqA.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟列表"/></a><div class="content"><a class="title" href="/posts/300a8ca5/" title="虚拟列表">虚拟列表</a><time datetime="2024-08-07T14:00:05.000Z" title="更新于 2024-08-07 22:00:05">2024-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/aac5e919/" title="JS手写题大汇总"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2024/01/02/iZE5AlbUXChmN2t.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS手写题大汇总"/></a><div class="content"><a class="title" href="/posts/aac5e919/" title="JS手写题大汇总">JS手写题大汇总</a><time datetime="2024-05-30T02:19:03.000Z" title="更新于 2024-05-30 10:19:03">2024-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/adf5c49/" title="Vue2笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/11/24/DdC1QyeWBFzhfGA.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue2笔记"/></a><div class="content"><a class="title" href="/posts/adf5c49/" title="Vue2笔记">Vue2笔记</a><time datetime="2024-05-10T10:01:20.000Z" title="更新于 2024-05-10 18:01:20">2024-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b672a0f6/" title="LeetCode 算法笔记 Part2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2024/02/25/SGcqKat5L3peFsE.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LeetCode 算法笔记 Part2"/></a><div class="content"><a class="title" href="/posts/b672a0f6/" title="LeetCode 算法笔记 Part2">LeetCode 算法笔记 Part2</a><time datetime="2024-04-15T16:17:32.000Z" title="更新于 2024-04-16 00:17:32">2024-04-16</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By 希亚的西红柿</div><div class="footer_custom_text"><p class="para"><a target="_blank"style="display: inline-block; margin-inline: 5px"href="https://hexo.io/" rel="external nofollow noreferrer"title="博客框架为Hexo_v5.4.2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo"/></a><a target="_blank"style="display: inline-block; margin-inline: 5px"href="https://butterfly.js.org/" rel="external nofollow noreferrer"title="主题版本Butterfly_v4.9.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender"/></a><a target="_blank"style="display: inline-block; margin-inline: 5px"href="https://github.com/" rel="external nofollow noreferrer"title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub"/></a><a target="_blank"style="display: inline-block; margin-inline: 5px"href="https://www.jsdelivr.com/" rel="external nofollow noreferrer"title="本站使用JsDelivr为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr"/></a><a target="_blank"style="display: inline-block; margin-inline: 5px"href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer"title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris"/></a><a target="_blank"style="display: inline-block; margin-inline: 5px"href="https://icp.gov.moe/?keyword=20231751" rel="external nofollow noreferrer"title="萌ICP备20231751号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E8%90%8CICP%E5%A4%87-20231751-fe1384?style-flat&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAAByxJREFUSInl1nlwVeUZx/HPuTckkD0kQFiCEEIUlNUCAqKoSBV1AIt1ikpVLFbLONjWGUXbmWrbweJMy7hUxbbTjsUq6KCiWEvr0kE2WVK2QCKBJCxJgEASsienfxwqMob+3Zm+f93z3vM+32f5vc9z+H9bwVcfOp/YQ+1prhhEZS1VDQzqQ1MjiQmIC5Liwm3lBWpqFimrulb/7A/067vM2IsOBZ2h8MhJQW6KMDNVsKeaizKEyUlsKueqgWJ39AMJF3QpDCNYr1SaEig/lWNX2Z1h6dH5/lVyGdVIZFf7MHo9bEfh9rCg/+8NyHlN77QTsnpQ0i2y08VK+BosfhbW0cHxqmSfFd9qW+l9Pi+5WltFdGTsOBbO5dJcdh3lN5+xff0Y2zuelXjRsyYUrjOu4BVJaavlpbWIJRBLOM+J81O95AAnTtM9vNHGknut3zdT48FutJE3koWTuG4oSXH+VsInX3B9IdcVUNfCuv08t4GjO6NspOa3BNcOXx1eOugVHQnrTMkTuyWrC/BjRZO9uPYTpw7HhTWkXcLd45l9GblpHD7NWzt5ZTMXZ/OdkTy+lvR07rmcmWffq6pn9W5e/oymfcT6kJbXHiydMyVYkL/x66n+ZMcctQfjhgxl6UIGZ3Ooltd2RIZqjqKRS0ew9cFIA1cO5urlLHuPZWsZPJiZw7gqn0VT2HCIR9+jvCQhfHPrLGyE2Hng2roBxHnmJoZnc9drbD3I6QaaWkjpSVoeu4+x5XB05qMDqCenHz37UHmcFRv54ZuMeoYrB/L0DPRgZ0WfrsXVKzPX3nYykrn3dUZl8+Q0Qox/gc/L6ZlKzxQefo+UROpa6Z4VCedkPd8YyJYHI3u5T/HAShZNQxsXZfR3pCtwRW066VEeOuIUVUf77+9jTw2pycTOJml7Je1t9EgiI5X2jkgyze1fCSSdtjhBiJCkpKyuI+5oTdAtkTCgVwrbKsl8ko6QjO40tZ67EpkpdIbRf20dkbPpPTjdwsSX6I5dJYy4hoQAaZQdDy4A1iEMI613T6LtBPXJpPakrjGqc1Y6CTFq62htJp5KRwPJKWSkU3WKiiPEEqO6xgM6oZmctJhDXYH7Z59xuCyKpK6R26ZE+ys3MWYoN1/Mc5uoqmbEQJ6fTc/ulJ3i/lUc+YIfzeKhKzjVHN31A3XRHddKSrf6/6DOV3VTcw1hVKfkxOhaPDAe1UwfwmNTqT1Drxw+nE9xNXetIjHG2vnoxoT+rNrN2Of58Rp6JZ+ldKes5kjX4G7dKuikpoERfaltYnQ/DOSS3hEAFk9lXQkLnmf7Ib65lPJT3HU1+46Tm8rYvgzKYVA2h+vQIMjvewHwdSN20MiOSmZczO4a1hSzYi77T7CiiPF5JMTZexjJ5OagkwNV9M+MnJ09nKU3smgyQ3PYWoEO4fUjii4QceJmevJuMeP6csUAln4atcbSGoqOUpjD30uZNwnpHNtN3lC+NZa1xeT34pGVTJ3PL9+Ohs6GQ8gVtHZs6VLVwZhBReGwoXvt3THM/hP0SWVnCR8f4PMjkffjB/DQS8waxpHFfFgaaeHZDRRtJn0yP5tF31ymFVJ2nN27GD66KBzca2/XEWdkUpD3Fmd4tYj0FMS54Q9UnuaDUv6yE/24ewWP/DU6N/d1fvousYEs28DyLVEvGDOAt/egmSkXv2VYn3NBfpXbua6J8hMFFvy2RHsL+57gmX+w/AN651PfEDWQzLRI+afqIqOxFDJT6Rbn9Bmad3PnTH5wIxOXkJTWGiz57hCDsyqDWVldRNzeyOh+paaPfpFKnvqQX88iZwDVx0lLJqUHbe3EkZ1Odm+yUqK2GHYKmhvIG8fyeTz9IY5x67jnFPapdPDkl6jzwEF9IDjZJlgwfbG+o2u8+g4rd7D/UYI41TXnevV5K4j2q6uESckUP8rvNrH6fUH/sRXB9AlPONMSDZ8uazwoi56JjEyvdftV88jinhf4uIzmJRQOoOYgja0RKAiIBZxpjvZH5tP0c97axcLlyBXOuWZemJTYFFbUCU+1dl3j8PGSyFhnJ7EkYcWh7/njqpep5xfzWTyZZ7dEg73xOJKiGqf3YenNLBjLTz7i539COg/OvSOYO2GFo/VRG0Zwe0YX4Ns3R7NXSCxBeM8IthXfZvGf3xCWc/kkXvg2vVP4YB/rDzC1gGlDo+50/xvs2khKPrNnzAzmTH5HbzR0fkkKro93Ab5vx9kfaGgT3lLA5EyWbRpoTdHbSreOppGJV/PwlRTksK+aZz5l6z+RLBgxaau5k2cJelTKzmRQMq0d51J8UxL+23d1TDTcj7WQllZu4YwxDo+eZc22X9mwd6gN65GIFmQzampxcMOoR1xeuMbpVoqromsXdG3+wmCiekNtfSSmiUNWu2zgap+WjlZW8X11TeNkpWwICvNfCm8u3Cmxg4PN0VdmEJw7/7+0/g32RaqCbhRecAAAAABJRU5ErkJggg=="/></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://npm.elemecdn.com/@fancyapps/ui@latest/dist/fancybox/fancybox.umd.js"></script><script src="https://npm.elemecdn.com/instant.page@latest/instantpage.js" type="module"></script><script src="https://npm.elemecdn.com/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.refrain.site/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.refrain.site/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.textContent = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo@latest/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.refrain.site/',
        region: '',
        pageSize: 5,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo@latest/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div id="my-aplayer" class="aplayer no-destroy" data-id="705468337" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-order="random" data-volume="0.55" data-theme="#80c8f8" data-preload="none"></div><script src="/js/hideLrc.js" async></script><script src="https://npm.elemecdn.com/butterfly-extsrc@latest/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://npm.elemecdn.com/aplayer@latest/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://npm.elemecdn.com/aplayer@latest/dist/APlayer.min.js"></script><script src="https://npm.elemecdn.com/butterfly-extsrc@latest/metingjs/dist/Meting.min.js"></script><script src="https://npm.elemecdn.com/pjax@latest/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3.8.2"/><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3.8.2"></script><script>(() => {
  function getRelativePath(url) {
    const { pathname, hash } = new URL(url, location.origin);
    return pathname.replace(/index\.html$/, true ? "" : ".html") + hash;
  }
  docsearch(
    Object.assign(
      {
        appId: "RKUHH8C2A1",
        apiKey: "8bf4436c1bda6de9adf486bbbbe5daec",
        indexName: "refrain",
        container: "#docsearch",
      },
      {
        placeholder: "搜索文档",
        translations: {
          button: { buttonText: "搜索", buttonAriaLabel: "搜索" },
          modal: {
            searchBox: {
              resetButtonTitle: "清除查询条件",
              resetButtonAriaLabel: "清除查询条件",
              cancelButtonText: "取消",
              cancelButtonAriaLabel: "取消",
            },
            startScreen: {
              recentSearchesTitle: "搜索历史",
              noRecentSearchesText: "没有搜索历史",
              saveRecentSearchButtonTitle: "保存到搜索历史",
              removeRecentSearchButtonTitle: "从搜索历史中移除",
              favoriteSearchesTitle: "收藏",
              removeFavoriteSearchButtonTitle: "从收藏中移除",
            },
            errorScreen: {
              titleText: "无法获取结果",
              helpText: "你可能需要检查你的网络连接",
            },
            footer: {
              selectText: "选择",
              selectKeyAriaLabel: "Enter key",
              navigateText: "切换",
              navigateUpKeyAriaLabel: "Arrow up",
              navigateDownKeyAriaLabel: "Arrow down",
              closeText: "关闭",
              closeKeyAriaLabel: "Escape key",
              searchByText: "搜索供应商",
            },
            noResultsScreen: {
              noResultsText: "无法找到相关结果",
              suggestedQueryText: "你可以尝试查询",
              reportMissingResultsText: "你认为这个查询应该有结果？",
              reportMissingResultsLinkText: "向我们反馈",
            },
          },
        },
        transformItems(items) {
          return items.map((item) => {
            return Object.assign({}, item, {
              url: getRelativePath(item.url),
            });
          });
        },
        navigator: {
          navigate({ itemUrl }) {
            pjax.loadUrl(itemUrl);
          },
        },
        hitComponent({ hit, children }) {
          return {
            __v: null,
            type: "a",
            ref: undefined,
            constructor: undefined,
            key: undefined,
            props: {
              href: hit.url,
              children,
              onClick: (e) => {
                e.preventDefault();
                pjax.loadUrl(hit.url);
              },
            },
          };
        },
      }
    )
  );

  const searchClickFn = () => {
    document
      .querySelector("#search-button > .search")
      .addEventListener("click", () => {
        document.querySelector(".DocSearch-Button").click();
      });
  };

  searchClickFn();
  window.addEventListener("pjax:complete", searchClickFn);
})();</script></div></div><!-- hexo injector body_end start -->
<script src="https://cdn.jsdelivr.net/gh/nova1751/hexo-shiki-plugin@latest/lib/codeblock.min.js"></script>

  <script>
  const CODE_CONFIG = {
    beautify: true,
    highlightCopy: true,
    highlightLang: true,
    highlightHeightLimit: 360,
    isHighlightShrink: false,
    copy: {
      success: '复制成功',
      error: '复制失败',
      noSupport: '浏览器不支持',
    }
  };
  console.log(
    `%c hexo-shiki-plugin %c v1.0.25 %c https://github.com/nova1751/hexo-shiki-plugin`,
    "color: #fff; background: #5f5f5f",
    "color: #fff; background: #80c8f8",
    ""
  );
  </script>
  <script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock-nova1751@latest/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'ec43383f3cf34cf5980da257996d16db';
  var gaud_map_key = '42b66694cf0de3cdd1627f1b09aa977d';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock-nova1751@latest/lib/clock.min.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><!-- hexo injector body_end end --></body></html>